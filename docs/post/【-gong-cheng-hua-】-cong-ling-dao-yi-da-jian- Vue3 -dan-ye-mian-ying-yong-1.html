<!DOCTYPE html>
<html data-color-mode="light" data-dark-theme="dark" data-light-theme="light" lang="zh-CN">
<head>
    <meta content="text/html; charset=utf-8" http-equiv="content-type" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link href='https://mirrors.sustech.edu.cn/cdnjs/ajax/libs/Primer/21.0.7/primer.css' rel='stylesheet' />
    
    <link rel="icon" href="https://avatars.githubusercontent.com/u/35625289?v=4"><script>
        let theme = localStorage.getItem("meek_theme") || "light";
        document.documentElement.setAttribute("data-color-mode", theme);
    </script>
<meta name="description" content="| 插件 | 功能 | 
|-------|-------|
| vue3 |  | 
| ts |  |
| pinia | 状态管理 |
| vue-router |  |
| vue-i18n |  |
| element-plus | UI框架 |
| axios |  |
| eslint | 规范 |
| less | css处理器 |
| commitlint | git提交规范|
| husky | git钩子触发器 |

## 初始化框架
### 安裝vue
```js 
npm init vue@latest
```
### 初始化
```js vite.config.ts
import { fileURLToPath, URL } from 'node:url';

import { defineConfig } from 'vite';
import vue from '@vitejs/plugin-vue';
// 如果编辑器提示 path 模块找不到，则可以安装一下 @types/node -> npm i @types/node -D
import path from 'path';
// https://vitejs.dev/config/
export default defineConfig({
  // 需要用到的插件数组
  plugins: [vue()],
  // 解析
  resolve: {
    alias: {
      '@': fileURLToPath(new URL('./src', import.meta.url)),
    },
  },
  // 开发或生产环境服务的公共基础路径
  base: './',
  // 服务器选项
  server: {
    // 指定开发服务器端口
    port: 4000,
    // 在开发服务器启动时自动在浏览器中打开应用程序
    open: true,
    // 为开发服务器配置 CORS
    cors: true,
  },
});
```
### 初始化目录
```js
├─ .vscode
│  └─ extensions.json
├─ bulid			# 打包配置模块
├─ public			# 公共资源模块
│  └─ favicon.ico
├─ src
│  ├─ api			# 接口管理模块
│  ├─ assets		# 静态资源模块
│  │  └─ logo.png
│  ├─ common		# 自定义通用模块
│  ├─ components	# 公共组件模块
│  │  └─ HelloWorld.vue
│  ├─ layouts		# 公共自定义布局
│  ├─ router		# 路由
│  ├─ stores		# pinia状态库
│  ├─ style			# 样式资源模块
│  ├─ utils			# 公共方法模块
│  ├─ views			# 视图模块
│  ├─ App.vue
│  ├─ env.d.ts
│  └─ main.ts		# 入口文件
├─ tests
├─ types			# 声明文件
├─ .gitignore
├─ index.html
├─ package-lock.json
├─ package.json
├─ README.md
├─ tsconfig.json
└─ vite.config.ts

```
## 初始化路由
### 安装路由
```js
npm install vue-router
```
### 配置路由文件
### 挂载路由
```js
import { createApp } from 'vue';
import App from './App.vue';
import router from '@/router/index';

const app = createApp(App);

app.use(router);

app.mount('#app');
```
## 初始化状态
### 安装pinia
```js
npm install pinia

```
### 配置状态仓库
```js index.ts
import type { App } from 'vue';
import { createPinia } from 'pinia';

const store = createPinia();

export function setupStore(app: App<Element>) {
  app.use(store);
}

export { store };

```
```js userStore.ts
import { store } from '@/store';
import { defineStore } from 'pinia';

export const useUserStore = defineStore({
  id: 'userStore',
  state: () => ({}),
  getters: {},
  actions: {},  
});

export function useUserStoreHook() {
  return useUserStore(store);
}
```
### 挂载
```js
import { createApp } from 'vue';
import App from './App.vue';
import { setupStore } from '@/store';

const app = createApp(App);

// 配置状态仓库
setupStore(app);

app.mount('#app');

```
## 集成element-plus组件库
### 安装
```js
npm install element-plus --save

```
### 选择导入方式
- 完全导入
```
import type { App } from 'vue';

/**
 * 完整导入 element-plus 组件
 * @param app {App}
 */
import ElementPlus from 'element-plus';
import 'element-plus/dist/index.css';
import '@/style/element-plus.css';
import Modal from '@/components/Dialog';

/**
 * 完整导入 element-plus 图标
 * @param app {App}
 */
import * as ElementPlusIconsVue from '@element-plus/icons-vue';

export default function fullLoadEl(app: App, params: Object) {
  app.use(ElementPlus, params);
  for (const [key, component] of Object.entries(ElementPlusIconsVue)) {
    app.component(key, component);
  }
  Modal._context = app._context;
  return app;
}
```
- 按需导入
```js
import type { App } from 'vue';

/**
 * 按需导入 element-plus 组件
 * @param app {App}
 */
import 'element-plus/dist/index.css';
import { ElIcon, ElButton, ElInput, ElCheckbox } from 'element-plus';
import '@/style/element-plus.css';

/**
 * 按需导入 element-plus 图标
 * @param app {App}
 */
import { Edit, Tools, Location, Setting } from '@element-plus/icons-vue';

export default function loadOnDemandEl(app: App) {
  [ElButton, ElIcon, ElInput, ElCheckbox].forEach((v) => {
    app.use(v);
  });
  [Edit, Tools, Location, Setting].forEach((v) => {
    app.component(v.name, v);
  });
  return app;
}
```

### 加载
```js
import { createApp } from 'vue';
import App from './App.vue';
import fullLoadEl from '@/packages/element-plus/fullLoadEl ';

const app = createApp(App);

// 全局引入
fullLoadEl(app);

app.mount('#app');
```
## 集成axios
### 安装axios
```js
npm install axios
```
### 二次封装axios
参考vben-admin对axios的封装
调用封装的axios类VAxios，传自设参数和项目预设参数的合并对象为参数，生成VAxios实例对象
```js
import type { AxiosResponse } from 'axios';
import type { RequestOptions, Result } from './types/axios';
/*
  export type ErrorMessageMode = 'none' | 'modal' | 'message' | undefined;
  export type SuccessMessageMode = 'none' | 'message';

  export interface RequestOptions {
    // Format request parameter time
    formatDate?: boolean;
    // Whether to process the request result
    isTransformResponse?: boolean;
    // Whether to return native response headers
    // For example: use this attribute when you need to get the response headers
    isReturnNativeResponse?: boolean;
    // Error message prompt type
    errorMessageMode?: ErrorMessageMode;
    // Successful request message prompt
    successMessageMode?: SuccessMessageMode;
    // Whether to add a timestamp
    joinTime?: boolean;
    ignoreCancelToken?: boolean;
    // Whether to send token in header
    withToken?: boolean;
    // 请求重试机制
    retryRequest?: RetryRequest;
  }

  export interface Result<T = any> {
    code: number | string;
    type: 'success' | 'error' | 'warning';
    msg: string;
    data: T;
  }

  // multipart/form-data: upload file
  export interface UploadFileParams {
    // Other parameters
    data?: Recordable;
    // File parameter interface field name
    name?: string;
    // file name
    file: File | Blob;
    // file name
    filename?: string;
    [key: string]: any;
  }
*/
import type { AxiosTransform, CreateAxiosOptions } from '@/packages/http/axios/axiosTransform';
import axios from 'axios';
import { clone } from 'lodash-es';
import { VAxios } from '@/packages/http/axios/Axios';
import { checkStatus } from '@/packages/http/axios/checkStatus';
import { AxiosRetry } from '@/packages/http/axios/axiosRetry';
import { joinTimestamp, formatRequestDate } from '@/packages/http/axios/helper';
import { RequestEnum, ResultEnum, ContentTypeEnum } from '@/enums/httpEnum';
/*

  // @description: Request result set
  export enum ResultEnum {
    SUCCESS = 200,
    ERROR = -1,
    TIMEOUT = 401,
    TYPE = 'success',
  }

  // @description: request method
  export enum RequestEnum {
    GET = 'GET',
    POST = 'POST',
    PUT = 'PUT',
    DELETE = 'DELETE',
  }

  // @description:  contentType
  export enum ContentTypeEnum {
    // json
    JSON = 'application/json;charset=UTF-8',
    // form-data qs
    FORM_URLENCODED = 'application/x-www-form-urlencoded;charset=UTF-8',
    // form-data  upload
    FORM_DATA = 'multipart/form-data;charset=UTF-8',
  }
*/
import { deepMerge } from '@/utils';
/*
  export function deepMerge<T = any>(src: any = {}, target: any = {}): T {
    let key: string;
    for (key in target) {
      src[key] = isObject(src[key]) ? deepMerge(src[key], target[key]) : (src[key] = target[key]);
    }
    return src;
  }
*/
import { getAppEnvConfig } from '@/utils/env';
/* 
  // build/getConfigFileName.ts
  export const getConfigFileName = (env: Record<string, any>) => {
    return `__PRODUCTION__${env.VITE_GLOB_APP_SHORT_NAME || '__APP'}__CONF__`
      .toUpperCase()
      .replace(/\s/g, '');
  };

  export function getAppEnvConfig() {
    const ENV_NAME = getConfigFileName(import.meta.env);
      
    const ENV = (import.meta.env.DEV
      ? // Get the global configuration (the configuration will be extracted independently when packaging)
        (import.meta.env as unknown as GlobEnvConfig)
      : window[ENV_NAME as any]) as unknown as GlobEnvConfig;

    const { VITE_GLOB_API_URL } = ENV;

    return {
      VITE_GLOB_API_URL,
    };
 }
*/
import { removeToken，getToken } from '@/utils/token';
/*
  import Cookies from 'js-cookie';

  const TokenKey = 'Token';

  export function getToken() {
    return Cookies.get(TokenKey);
  }

  export function setToken(token: string) {
    return Cookies.set(TokenKey, token);
  }

  export function removeToken() {
    return Cookies.remove(TokenKey);
  }
*/
import { isString } from '@/utils/is';
/*
  const toString = Object.prototype.toString;

  export function is(val: unknown, type: string) {
    return toString.call(val) === `[object ${type}]`;
  }
  
  export function isString(val: unknown): val is string {
    return is(val, 'String');
  }
*/
import { useUserStoreWithOut } from '$store/user';
import { ElMessage, ElMessageBox } from 'element-plus';
import { s } from '$locale';

const { VITE_GLOB_API_URL } = getAppEnvConfig();

const transform: AxiosTransform = {
  /**
   * @description: 处理响应数据。">
<meta property="og:title" content="【工程化】从零到一搭建 Vue3 单页面应用1">
<meta property="og:description" content="| 插件 | 功能 | 
|-------|-------|
| vue3 |  | 
| ts |  |
| pinia | 状态管理 |
| vue-router |  |
| vue-i18n |  |
| element-plus | UI框架 |
| axios |  |
| eslint | 规范 |
| less | css处理器 |
| commitlint | git提交规范|
| husky | git钩子触发器 |

## 初始化框架
### 安裝vue
```js 
npm init vue@latest
```
### 初始化
```js vite.config.ts
import { fileURLToPath, URL } from 'node:url';

import { defineConfig } from 'vite';
import vue from '@vitejs/plugin-vue';
// 如果编辑器提示 path 模块找不到，则可以安装一下 @types/node -> npm i @types/node -D
import path from 'path';
// https://vitejs.dev/config/
export default defineConfig({
  // 需要用到的插件数组
  plugins: [vue()],
  // 解析
  resolve: {
    alias: {
      '@': fileURLToPath(new URL('./src', import.meta.url)),
    },
  },
  // 开发或生产环境服务的公共基础路径
  base: './',
  // 服务器选项
  server: {
    // 指定开发服务器端口
    port: 4000,
    // 在开发服务器启动时自动在浏览器中打开应用程序
    open: true,
    // 为开发服务器配置 CORS
    cors: true,
  },
});
```
### 初始化目录
```js
├─ .vscode
│  └─ extensions.json
├─ bulid			# 打包配置模块
├─ public			# 公共资源模块
│  └─ favicon.ico
├─ src
│  ├─ api			# 接口管理模块
│  ├─ assets		# 静态资源模块
│  │  └─ logo.png
│  ├─ common		# 自定义通用模块
│  ├─ components	# 公共组件模块
│  │  └─ HelloWorld.vue
│  ├─ layouts		# 公共自定义布局
│  ├─ router		# 路由
│  ├─ stores		# pinia状态库
│  ├─ style			# 样式资源模块
│  ├─ utils			# 公共方法模块
│  ├─ views			# 视图模块
│  ├─ App.vue
│  ├─ env.d.ts
│  └─ main.ts		# 入口文件
├─ tests
├─ types			# 声明文件
├─ .gitignore
├─ index.html
├─ package-lock.json
├─ package.json
├─ README.md
├─ tsconfig.json
└─ vite.config.ts

```
## 初始化路由
### 安装路由
```js
npm install vue-router
```
### 配置路由文件
### 挂载路由
```js
import { createApp } from 'vue';
import App from './App.vue';
import router from '@/router/index';

const app = createApp(App);

app.use(router);

app.mount('#app');
```
## 初始化状态
### 安装pinia
```js
npm install pinia

```
### 配置状态仓库
```js index.ts
import type { App } from 'vue';
import { createPinia } from 'pinia';

const store = createPinia();

export function setupStore(app: App<Element>) {
  app.use(store);
}

export { store };

```
```js userStore.ts
import { store } from '@/store';
import { defineStore } from 'pinia';

export const useUserStore = defineStore({
  id: 'userStore',
  state: () => ({}),
  getters: {},
  actions: {},  
});

export function useUserStoreHook() {
  return useUserStore(store);
}
```
### 挂载
```js
import { createApp } from 'vue';
import App from './App.vue';
import { setupStore } from '@/store';

const app = createApp(App);

// 配置状态仓库
setupStore(app);

app.mount('#app');

```
## 集成element-plus组件库
### 安装
```js
npm install element-plus --save

```
### 选择导入方式
- 完全导入
```
import type { App } from 'vue';

/**
 * 完整导入 element-plus 组件
 * @param app {App}
 */
import ElementPlus from 'element-plus';
import 'element-plus/dist/index.css';
import '@/style/element-plus.css';
import Modal from '@/components/Dialog';

/**
 * 完整导入 element-plus 图标
 * @param app {App}
 */
import * as ElementPlusIconsVue from '@element-plus/icons-vue';

export default function fullLoadEl(app: App, params: Object) {
  app.use(ElementPlus, params);
  for (const [key, component] of Object.entries(ElementPlusIconsVue)) {
    app.component(key, component);
  }
  Modal._context = app._context;
  return app;
}
```
- 按需导入
```js
import type { App } from 'vue';

/**
 * 按需导入 element-plus 组件
 * @param app {App}
 */
import 'element-plus/dist/index.css';
import { ElIcon, ElButton, ElInput, ElCheckbox } from 'element-plus';
import '@/style/element-plus.css';

/**
 * 按需导入 element-plus 图标
 * @param app {App}
 */
import { Edit, Tools, Location, Setting } from '@element-plus/icons-vue';

export default function loadOnDemandEl(app: App) {
  [ElButton, ElIcon, ElInput, ElCheckbox].forEach((v) => {
    app.use(v);
  });
  [Edit, Tools, Location, Setting].forEach((v) => {
    app.component(v.name, v);
  });
  return app;
}
```

### 加载
```js
import { createApp } from 'vue';
import App from './App.vue';
import fullLoadEl from '@/packages/element-plus/fullLoadEl ';

const app = createApp(App);

// 全局引入
fullLoadEl(app);

app.mount('#app');
```
## 集成axios
### 安装axios
```js
npm install axios
```
### 二次封装axios
参考vben-admin对axios的封装
调用封装的axios类VAxios，传自设参数和项目预设参数的合并对象为参数，生成VAxios实例对象
```js
import type { AxiosResponse } from 'axios';
import type { RequestOptions, Result } from './types/axios';
/*
  export type ErrorMessageMode = 'none' | 'modal' | 'message' | undefined;
  export type SuccessMessageMode = 'none' | 'message';

  export interface RequestOptions {
    // Format request parameter time
    formatDate?: boolean;
    // Whether to process the request result
    isTransformResponse?: boolean;
    // Whether to return native response headers
    // For example: use this attribute when you need to get the response headers
    isReturnNativeResponse?: boolean;
    // Error message prompt type
    errorMessageMode?: ErrorMessageMode;
    // Successful request message prompt
    successMessageMode?: SuccessMessageMode;
    // Whether to add a timestamp
    joinTime?: boolean;
    ignoreCancelToken?: boolean;
    // Whether to send token in header
    withToken?: boolean;
    // 请求重试机制
    retryRequest?: RetryRequest;
  }

  export interface Result<T = any> {
    code: number | string;
    type: 'success' | 'error' | 'warning';
    msg: string;
    data: T;
  }

  // multipart/form-data: upload file
  export interface UploadFileParams {
    // Other parameters
    data?: Recordable;
    // File parameter interface field name
    name?: string;
    // file name
    file: File | Blob;
    // file name
    filename?: string;
    [key: string]: any;
  }
*/
import type { AxiosTransform, CreateAxiosOptions } from '@/packages/http/axios/axiosTransform';
import axios from 'axios';
import { clone } from 'lodash-es';
import { VAxios } from '@/packages/http/axios/Axios';
import { checkStatus } from '@/packages/http/axios/checkStatus';
import { AxiosRetry } from '@/packages/http/axios/axiosRetry';
import { joinTimestamp, formatRequestDate } from '@/packages/http/axios/helper';
import { RequestEnum, ResultEnum, ContentTypeEnum } from '@/enums/httpEnum';
/*

  // @description: Request result set
  export enum ResultEnum {
    SUCCESS = 200,
    ERROR = -1,
    TIMEOUT = 401,
    TYPE = 'success',
  }

  // @description: request method
  export enum RequestEnum {
    GET = 'GET',
    POST = 'POST',
    PUT = 'PUT',
    DELETE = 'DELETE',
  }

  // @description:  contentType
  export enum ContentTypeEnum {
    // json
    JSON = 'application/json;charset=UTF-8',
    // form-data qs
    FORM_URLENCODED = 'application/x-www-form-urlencoded;charset=UTF-8',
    // form-data  upload
    FORM_DATA = 'multipart/form-data;charset=UTF-8',
  }
*/
import { deepMerge } from '@/utils';
/*
  export function deepMerge<T = any>(src: any = {}, target: any = {}): T {
    let key: string;
    for (key in target) {
      src[key] = isObject(src[key]) ? deepMerge(src[key], target[key]) : (src[key] = target[key]);
    }
    return src;
  }
*/
import { getAppEnvConfig } from '@/utils/env';
/* 
  // build/getConfigFileName.ts
  export const getConfigFileName = (env: Record<string, any>) => {
    return `__PRODUCTION__${env.VITE_GLOB_APP_SHORT_NAME || '__APP'}__CONF__`
      .toUpperCase()
      .replace(/\s/g, '');
  };

  export function getAppEnvConfig() {
    const ENV_NAME = getConfigFileName(import.meta.env);
      
    const ENV = (import.meta.env.DEV
      ? // Get the global configuration (the configuration will be extracted independently when packaging)
        (import.meta.env as unknown as GlobEnvConfig)
      : window[ENV_NAME as any]) as unknown as GlobEnvConfig;

    const { VITE_GLOB_API_URL } = ENV;

    return {
      VITE_GLOB_API_URL,
    };
 }
*/
import { removeToken，getToken } from '@/utils/token';
/*
  import Cookies from 'js-cookie';

  const TokenKey = 'Token';

  export function getToken() {
    return Cookies.get(TokenKey);
  }

  export function setToken(token: string) {
    return Cookies.set(TokenKey, token);
  }

  export function removeToken() {
    return Cookies.remove(TokenKey);
  }
*/
import { isString } from '@/utils/is';
/*
  const toString = Object.prototype.toString;

  export function is(val: unknown, type: string) {
    return toString.call(val) === `[object ${type}]`;
  }
  
  export function isString(val: unknown): val is string {
    return is(val, 'String');
  }
*/
import { useUserStoreWithOut } from '$store/user';
import { ElMessage, ElMessageBox } from 'element-plus';
import { s } from '$locale';

const { VITE_GLOB_API_URL } = getAppEnvConfig();

const transform: AxiosTransform = {
  /**
   * @description: 处理响应数据。">
<meta property="og:type" content="article">
<meta property="og:url" content="https://199yjy.github.io/record.github.io/post/%E3%80%90-gong-cheng-hua-%E3%80%91-cong-ling-dao-yi-da-jian-%20Vue3%20-dan-ye-mian-ying-yong-1.html">
<meta property="og:image" content="https://avatars.githubusercontent.com/u/35625289?v=4">
<title>【工程化】从零到一搭建 Vue3 单页面应用1</title>
<link href="//unpkg.com/@wooorm/starry-night@2.1.1/style/both.css" rel="stylesheet" />


</head>
<style>
body{box-sizing: border-box;min-width: 200px;max-width: 900px;margin: 20px auto;padding: 45px;font-size: 16px;font-family: sans-serif;line-height: 1.25;}
#header{display:flex;padding-bottom:8px;border-bottom: 1px solid var(--borderColor-muted, var(--color-border-muted));margin-bottom: 16px;}
#footer {margin-top:64px; text-align: center;font-size: small;}

</style>

<style>
.postTitle{margin: auto 0;font-size:40px;font-weight:bold;}
.title-right{display:flex;margin:auto 0 0 auto;}
.title-right .circle{padding: 14px 16px;margin-right:8px;}
#postBody{border-bottom: 1px solid var(--color-border-default);padding-bottom:36px;}
#postBody hr{height:2px;}
#cmButton{height:48px;margin-top:48px;}
#comments{margin-top:64px;}
.g-emoji{font-size:24px;}
@media (max-width: 600px) {
    body {padding: 8px;}
    .postTitle{font-size:24px;}
}
.copy-feedback {
    display: none;
    position: absolute;
    top: 10px;
    right: 50px;
    color: var(--color-fg-on-emphasis);
    background-color: var(--color-fg-muted);
    border-radius: 3px;
    padding: 5px 8px;
    font-size: 12px;
}
</style>




<body>
    <div id="header">
<h1 class="postTitle">【工程化】从零到一搭建 Vue3 单页面应用1</h1>
<div class="title-right">
    <a href="https://199yjy.github.io/record.github.io" id="buttonHome" class="btn btn-invisible circle" title="首页">
        <svg class="octicon" width="16" height="16">
            <path id="pathHome" fill-rule="evenodd"></path>
        </svg>
    </a>
    
    <a href="https://github.com/199yjy/record.github.io/issues/7" target="_blank" class="btn btn-invisible circle" title="Issue">
        <svg class="octicon" width="16" height="16">
            <path id="pathIssue" fill-rule="evenodd"></path>
        </svg>
    </a>
    

    <a class="btn btn-invisible circle" onclick="modeSwitch();" title="切换主题">
        <svg class="octicon" width="16" height="16" >
            <path id="themeSwitch" fill-rule="evenodd"></path>
        </svg>
    </a>

</div>
</div>
    <div id="content">
<div class="markdown-body" id="postBody"><markdown-accessiblity-table><table role="table">
<thead>
<tr>
<th>插件</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td>vue3</td>
<td></td>
</tr>
<tr>
<td>ts</td>
<td></td>
</tr>
<tr>
<td>pinia</td>
<td>状态管理</td>
</tr>
<tr>
<td>vue-router</td>
<td></td>
</tr>
<tr>
<td>vue-i18n</td>
<td></td>
</tr>
<tr>
<td>element-plus</td>
<td>UI框架</td>
</tr>
<tr>
<td>axios</td>
<td></td>
</tr>
<tr>
<td>eslint</td>
<td>规范</td>
</tr>
<tr>
<td>less</td>
<td>css处理器</td>
</tr>
<tr>
<td>commitlint</td>
<td>git提交规范</td>
</tr>
<tr>
<td>husky</td>
<td>git钩子触发器</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<h2>初始化框架</h2>
<h3>安裝vue</h3>
<div class="highlight highlight-source-js"><pre class="notranslate"><span class="pl-s1">npm</span> <span class="pl-s1">init</span> <span class="pl-s1">vue</span>@<span class="pl-s1">latest</span></pre></div>
<h3>初始化</h3>
<div class="highlight highlight-source-js"><pre class="notranslate"><span class="pl-k">import</span> <span class="pl-kos">{</span> <span class="pl-s1">fileURLToPath</span><span class="pl-kos">,</span> <span class="pl-c1">URL</span> <span class="pl-kos">}</span> <span class="pl-k">from</span> <span class="pl-s">"node:url"</span><span class="pl-kos">;</span>

<span class="pl-k">import</span> <span class="pl-kos">{</span> <span class="pl-s1">defineConfig</span> <span class="pl-kos">}</span> <span class="pl-k">from</span> <span class="pl-s">"vite"</span><span class="pl-kos">;</span>
<span class="pl-k">import</span> <span class="pl-s1">vue</span> <span class="pl-k">from</span> <span class="pl-s">"@vitejs/plugin-vue"</span><span class="pl-kos">;</span>
<span class="pl-c">// 如果编辑器提示 path 模块找不到，则可以安装一下 @types/node -&gt; npm i @types/node -D</span>
<span class="pl-k">import</span> <span class="pl-s1">path</span> <span class="pl-k">from</span> <span class="pl-s">"path"</span><span class="pl-kos">;</span>
<span class="pl-c">// https://vitejs.dev/config/</span>
<span class="pl-k">export</span> <span class="pl-k">default</span> <span class="pl-en">defineConfig</span><span class="pl-kos">(</span><span class="pl-kos">{</span>
  <span class="pl-c">// 需要用到的插件数组</span>
  <span class="pl-c1">plugins</span>: <span class="pl-kos">[</span><span class="pl-en">vue</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">]</span><span class="pl-kos">,</span>
  <span class="pl-c">// 解析</span>
  <span class="pl-c1">resolve</span>: <span class="pl-kos">{</span>
    <span class="pl-c1">alias</span>: <span class="pl-kos">{</span>
      <span class="pl-s">"@"</span>: <span class="pl-en">fileURLToPath</span><span class="pl-kos">(</span><span class="pl-k">new</span> <span class="pl-c1">URL</span><span class="pl-kos">(</span><span class="pl-s">"./src"</span><span class="pl-kos">,</span> <span class="pl-k">import</span><span class="pl-kos">.</span>meta<span class="pl-kos">.</span><span class="pl-c1">url</span><span class="pl-kos">)</span><span class="pl-kos">)</span><span class="pl-kos">,</span>
    <span class="pl-kos">}</span><span class="pl-kos">,</span>
  <span class="pl-kos">}</span><span class="pl-kos">,</span>
  <span class="pl-c">// 开发或生产环境服务的公共基础路径</span>
  <span class="pl-c1">base</span>: <span class="pl-s">"./"</span><span class="pl-kos">,</span>
  <span class="pl-c">// 服务器选项</span>
  <span class="pl-c1">server</span>: <span class="pl-kos">{</span>
    <span class="pl-c">// 指定开发服务器端口</span>
    <span class="pl-c1">port</span>: <span class="pl-c1">4000</span><span class="pl-kos">,</span>
    <span class="pl-c">// 在开发服务器启动时自动在浏览器中打开应用程序</span>
    <span class="pl-c1">open</span>: <span class="pl-c1">true</span><span class="pl-kos">,</span>
    <span class="pl-c">// 为开发服务器配置 CORS</span>
    <span class="pl-c1">cors</span>: <span class="pl-c1">true</span><span class="pl-kos">,</span>
  <span class="pl-kos">}</span><span class="pl-kos">,</span>
<span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span></pre></div>
<h3>初始化目录</h3>
<div class="highlight highlight-source-js"><pre class="notranslate"><span class="pl-s1">├─</span> <span class="pl-kos">.</span><span class="pl-c1">vscode</span>
<span class="pl-s1">│</span>  <span class="pl-s1">└─</span> <span class="pl-s1">extensions</span><span class="pl-kos">.</span><span class="pl-c1">json</span>
<span class="pl-s1">├─</span> <span class="pl-s1">bulid</span>			# <span class="pl-s1">打包配置模块</span>
<span class="pl-s1">├─</span> <span class="pl-s1">public</span>			# <span class="pl-s1">公共资源模块</span>
<span class="pl-s1">│</span>  <span class="pl-s1">└─</span> <span class="pl-s1">favicon</span><span class="pl-kos">.</span><span class="pl-c1">ico</span>
<span class="pl-s1">├─</span><span class="pl-kos"></span> <span class="pl-s1">src</span>
<span class="pl-s1">│</span>  <span class="pl-s1">├─</span> <span class="pl-s1">api</span>			# <span class="pl-s1">接口管理模块</span>
<span class="pl-s1">│</span>  <span class="pl-s1">├─</span> <span class="pl-s1">assets</span>		# <span class="pl-s1">静态资源模块</span>
<span class="pl-s1">│</span>  <span class="pl-s1">│</span>  <span class="pl-s1">└─</span> <span class="pl-s1">logo</span><span class="pl-kos">.</span><span class="pl-c1">png</span>
<span class="pl-s1">│</span>  <span class="pl-s1">├─</span> <span class="pl-s1">common</span>		# <span class="pl-s1">自定义通用模块</span>
<span class="pl-s1">│</span>  <span class="pl-s1">├─</span> <span class="pl-s1">components</span>	# <span class="pl-s1">公共组件模块</span>
<span class="pl-s1">│</span>  <span class="pl-s1">│</span>  <span class="pl-s1">└─</span> <span class="pl-v">HelloWorld</span><span class="pl-kos">.</span><span class="pl-c1">vue</span>
<span class="pl-s1">│</span>  <span class="pl-s1">├─</span> <span class="pl-s1">layouts</span>		# <span class="pl-s1">公共自定义布局</span>
<span class="pl-s1">│</span>  <span class="pl-s1">├─</span> <span class="pl-s1">router</span>		# <span class="pl-s1">路由</span>
<span class="pl-s1">│</span>  <span class="pl-s1">├─</span> <span class="pl-s1">stores</span>		# <span class="pl-s1">pinia状态库</span>
<span class="pl-s1">│</span>  <span class="pl-s1">├─</span> <span class="pl-s1">style</span>			# <span class="pl-s1">样式资源模块</span>
<span class="pl-s1">│</span>  <span class="pl-s1">├─</span> <span class="pl-s1">utils</span>			# <span class="pl-s1">公共方法模块</span>
<span class="pl-s1">│</span>  <span class="pl-s1">├─</span> <span class="pl-s1">views</span>			# <span class="pl-s1">视图模块</span>
<span class="pl-s1">│</span>  <span class="pl-s1">├─</span> <span class="pl-v">App</span><span class="pl-kos">.</span><span class="pl-c1">vue</span>
<span class="pl-s1">│</span>  <span class="pl-s1">├─</span> <span class="pl-s1">env</span><span class="pl-kos">.</span><span class="pl-c1">d</span><span class="pl-kos">.</span><span class="pl-c1">ts</span>
<span class="pl-s1">│</span>  <span class="pl-s1">└─</span> <span class="pl-s1">main</span><span class="pl-kos">.</span><span class="pl-c1">ts</span>		# <span class="pl-s1">入口文件</span>
<span class="pl-s1">├─</span><span class="pl-kos"></span> <span class="pl-s1">tests</span>
<span class="pl-s1">├─</span> <span class="pl-s1">types</span>			# <span class="pl-s1">声明文件</span>
<span class="pl-s1">├─</span> <span class="pl-kos">.</span><span class="pl-c1">gitignore</span>
<span class="pl-s1">├─</span> <span class="pl-s1">index</span><span class="pl-kos">.</span><span class="pl-c1">html</span>
<span class="pl-s1">├─</span> <span class="pl-s1">package</span><span class="pl-c1">-</span><span class="pl-s1">lock</span><span class="pl-kos">.</span><span class="pl-c1">json</span>
<span class="pl-s1">├─</span> <span class="pl-s1">package</span><span class="pl-kos">.</span><span class="pl-c1">json</span>
<span class="pl-s1">├─</span> <span class="pl-c1">README</span><span class="pl-kos">.</span><span class="pl-c1">md</span>
<span class="pl-s1">├─</span> <span class="pl-s1">tsconfig</span><span class="pl-kos">.</span><span class="pl-c1">json</span>
<span class="pl-s1">└─</span> <span class="pl-s1">vite</span><span class="pl-kos">.</span><span class="pl-c1">config</span><span class="pl-kos">.</span><span class="pl-c1">ts</span></pre></div>
<h2>初始化路由</h2>
<h3>安装路由</h3>
<div class="highlight highlight-source-js"><pre class="notranslate"><span class="pl-s1">npm</span> <span class="pl-s1">install</span> <span class="pl-s1">vue</span><span class="pl-c1">-</span><span class="pl-s1">router</span></pre></div>
<h3>配置路由文件</h3>
<h3>挂载路由</h3>
<div class="highlight highlight-source-js"><pre class="notranslate"><span class="pl-k">import</span> <span class="pl-kos">{</span> <span class="pl-s1">createApp</span> <span class="pl-kos">}</span> <span class="pl-k">from</span> <span class="pl-s">"vue"</span><span class="pl-kos">;</span>
<span class="pl-k">import</span> <span class="pl-v">App</span> <span class="pl-k">from</span> <span class="pl-s">"./App.vue"</span><span class="pl-kos">;</span>
<span class="pl-k">import</span> <span class="pl-s1">router</span> <span class="pl-k">from</span> <span class="pl-s">"@/router/index"</span><span class="pl-kos">;</span>

<span class="pl-k">const</span> <span class="pl-s1">app</span> <span class="pl-c1">=</span> <span class="pl-en">createApp</span><span class="pl-kos">(</span><span class="pl-v">App</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-s1">app</span><span class="pl-kos">.</span><span class="pl-en">use</span><span class="pl-kos">(</span><span class="pl-s1">router</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-s1">app</span><span class="pl-kos">.</span><span class="pl-en">mount</span><span class="pl-kos">(</span><span class="pl-s">"#app"</span><span class="pl-kos">)</span><span class="pl-kos">;</span></pre></div>
<h2>初始化状态</h2>
<h3>安装pinia</h3>
<div class="highlight highlight-source-js"><pre class="notranslate"><span class="pl-s1">npm</span> <span class="pl-s1">install</span> <span class="pl-s1">pinia</span></pre></div>
<h3>配置状态仓库</h3>
<div class="highlight highlight-source-js"><pre class="notranslate"><span class="pl-k">import</span> <span class="pl-s1">type</span> <span class="pl-kos">{</span> <span class="pl-v">App</span> <span class="pl-kos">}</span> <span class="pl-k">from</span> <span class="pl-s">"vue"</span><span class="pl-kos">;</span>
<span class="pl-k">import</span> <span class="pl-kos">{</span> <span class="pl-s1">createPinia</span> <span class="pl-kos">}</span> <span class="pl-k">from</span> <span class="pl-s">"pinia"</span><span class="pl-kos">;</span>

<span class="pl-k">const</span> <span class="pl-s1">store</span> <span class="pl-c1">=</span> <span class="pl-en">createPinia</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-k">export</span> <span class="pl-k">function</span> <span class="pl-en">setupStore</span><span class="pl-kos">(</span><span class="pl-s1">app</span>: <span class="pl-v">App</span><span class="pl-c1">&lt;</span><span class="pl-v">Element</span><span class="pl-c1">&gt;</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
  <span class="pl-s1">app</span><span class="pl-kos">.</span><span class="pl-en">use</span><span class="pl-kos">(</span><span class="pl-s1">store</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span>

<span class="pl-k">export</span> <span class="pl-kos">{</span> <span class="pl-s1">store</span> <span class="pl-kos">}</span><span class="pl-kos">;</span></pre></div>
<div class="highlight highlight-source-js"><pre class="notranslate"><span class="pl-k">import</span> <span class="pl-kos">{</span> <span class="pl-s1">store</span> <span class="pl-kos">}</span> <span class="pl-k">from</span> <span class="pl-s">"@/store"</span><span class="pl-kos">;</span>
<span class="pl-k">import</span> <span class="pl-kos">{</span> <span class="pl-s1">defineStore</span> <span class="pl-kos">}</span> <span class="pl-k">from</span> <span class="pl-s">"pinia"</span><span class="pl-kos">;</span>

<span class="pl-k">export</span> <span class="pl-k">const</span> <span class="pl-s1">useUserStore</span> <span class="pl-c1">=</span> <span class="pl-en">defineStore</span><span class="pl-kos">(</span><span class="pl-kos">{</span>
  <span class="pl-c1">id</span>: <span class="pl-s">"userStore"</span><span class="pl-kos">,</span>
  <span class="pl-en">state</span>: <span class="pl-kos">(</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-kos">(</span><span class="pl-kos">{</span><span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">,</span>
  <span class="pl-c1">getters</span>: <span class="pl-kos">{</span><span class="pl-kos">}</span><span class="pl-kos">,</span>
  <span class="pl-c1">actions</span>: <span class="pl-kos">{</span><span class="pl-kos">}</span><span class="pl-kos">,</span>  
<span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-k">export</span> <span class="pl-k">function</span> <span class="pl-en">useUserStoreHook</span><span class="pl-kos">(</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
  <span class="pl-k">return</span> <span class="pl-s1">useUserStore</span><span class="pl-kos">(</span><span class="pl-s1">store</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span></pre></div>
<h3>挂载</h3>
<div class="highlight highlight-source-js"><pre class="notranslate"><span class="pl-k">import</span> <span class="pl-kos">{</span> <span class="pl-s1">createApp</span> <span class="pl-kos">}</span> <span class="pl-k">from</span> <span class="pl-s">"vue"</span><span class="pl-kos">;</span>
<span class="pl-k">import</span> <span class="pl-v">App</span> <span class="pl-k">from</span> <span class="pl-s">"./App.vue"</span><span class="pl-kos">;</span>
<span class="pl-k">import</span> <span class="pl-kos">{</span> <span class="pl-s1">setupStore</span> <span class="pl-kos">}</span> <span class="pl-k">from</span> <span class="pl-s">"@/store"</span><span class="pl-kos">;</span>

<span class="pl-k">const</span> <span class="pl-s1">app</span> <span class="pl-c1">=</span> <span class="pl-en">createApp</span><span class="pl-kos">(</span><span class="pl-v">App</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-c">// 配置状态仓库</span>
<span class="pl-en">setupStore</span><span class="pl-kos">(</span><span class="pl-s1">app</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-s1">app</span><span class="pl-kos">.</span><span class="pl-en">mount</span><span class="pl-kos">(</span><span class="pl-s">"#app"</span><span class="pl-kos">)</span><span class="pl-kos">;</span></pre></div>
<h2>集成element-plus组件库</h2>
<h3>安装</h3>
<div class="highlight highlight-source-js"><pre class="notranslate"><span class="pl-s1">npm</span> <span class="pl-s1">install</span> <span class="pl-s1">element</span><span class="pl-c1">-</span><span class="pl-s1">plus</span> <span class="pl-c1">--</span><span class="pl-s1">save</span></pre></div>
<h3>选择导入方式</h3>
<ul>
<li>完全导入</li>
</ul>
<pre class="notranslate"><code class="notranslate">import type { App } from "vue";

/**
 * 完整导入 element-plus 组件
 * @param app {App}
 */
import ElementPlus from "element-plus";
import "element-plus/dist/index.css";
import "@/style/element-plus.css";
import Modal from "@/components/Dialog";

/**
 * 完整导入 element-plus 图标
 * @param app {App}
 */
import * as ElementPlusIconsVue from "@element-plus/icons-vue";

export default function fullLoadEl(app: App, params: Object) {
  app.use(ElementPlus, params);
  for (const [key, component] of Object.entries(ElementPlusIconsVue)) {
    app.component(key, component);
  }
  Modal._context = app._context;
  return app;
}
</code></pre>
<ul>
<li>按需导入</li>
</ul>
<div class="highlight highlight-source-js"><pre class="notranslate"><span class="pl-k">import</span> <span class="pl-s1">type</span> <span class="pl-kos">{</span> <span class="pl-v">App</span> <span class="pl-kos">}</span> <span class="pl-k">from</span> <span class="pl-s">"vue"</span><span class="pl-kos">;</span>

<span class="pl-c">/**</span>
<span class="pl-c"> * 按需导入 element-plus 组件</span>
<span class="pl-c"> * <span class="pl-k">@param</span> app {App}</span>
<span class="pl-c"> */</span>
<span class="pl-k">import</span> <span class="pl-s">"element-plus/dist/index.css"</span><span class="pl-kos">;</span>
<span class="pl-k">import</span> <span class="pl-kos">{</span> <span class="pl-v">ElIcon</span><span class="pl-kos">,</span> <span class="pl-v">ElButton</span><span class="pl-kos">,</span> <span class="pl-v">ElInput</span><span class="pl-kos">,</span> <span class="pl-v">ElCheckbox</span> <span class="pl-kos">}</span> <span class="pl-k">from</span> <span class="pl-s">"element-plus"</span><span class="pl-kos">;</span>
<span class="pl-k">import</span> <span class="pl-s">"@/style/element-plus.css"</span><span class="pl-kos">;</span>

<span class="pl-c">/**</span>
<span class="pl-c"> * 按需导入 element-plus 图标</span>
<span class="pl-c"> * <span class="pl-k">@param</span> app {App}</span>
<span class="pl-c"> */</span>
<span class="pl-k">import</span> <span class="pl-kos">{</span> <span class="pl-v">Edit</span><span class="pl-kos">,</span> <span class="pl-v">Tools</span><span class="pl-kos">,</span> <span class="pl-v">Location</span><span class="pl-kos">,</span> <span class="pl-v">Setting</span> <span class="pl-kos">}</span> <span class="pl-k">from</span> <span class="pl-s">"@element-plus/icons-vue"</span><span class="pl-kos">;</span>

<span class="pl-k">export</span> <span class="pl-k">default</span> <span class="pl-k">function</span> <span class="pl-en">loadOnDemandEl</span><span class="pl-kos">(</span><span class="pl-s1">app</span>: <span class="pl-v">App</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
  <span class="pl-kos">[</span><span class="pl-v">ElButton</span><span class="pl-kos">,</span> <span class="pl-v">ElIcon</span><span class="pl-kos">,</span> <span class="pl-v">ElInput</span><span class="pl-kos">,</span> <span class="pl-v">ElCheckbox</span><span class="pl-kos">]</span><span class="pl-kos">.</span><span class="pl-en">forEach</span><span class="pl-kos">(</span><span class="pl-kos">(</span><span class="pl-s1">v</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-kos">{</span>
    <span class="pl-s1">app</span><span class="pl-kos">.</span><span class="pl-en">use</span><span class="pl-kos">(</span><span class="pl-s1">v</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
  <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
  <span class="pl-kos">[</span><span class="pl-v">Edit</span><span class="pl-kos">,</span> <span class="pl-v">Tools</span><span class="pl-kos">,</span> <span class="pl-v">Location</span><span class="pl-kos">,</span> <span class="pl-v">Setting</span><span class="pl-kos">]</span><span class="pl-kos">.</span><span class="pl-en">forEach</span><span class="pl-kos">(</span><span class="pl-kos">(</span><span class="pl-s1">v</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-kos">{</span>
    <span class="pl-s1">app</span><span class="pl-kos">.</span><span class="pl-en">component</span><span class="pl-kos">(</span><span class="pl-s1">v</span><span class="pl-kos">.</span><span class="pl-c1">name</span><span class="pl-kos">,</span> <span class="pl-s1">v</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
  <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
  <span class="pl-k">return</span> <span class="pl-s1">app</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span></pre></div>
<h3>加载</h3>
<div class="highlight highlight-source-js"><pre class="notranslate"><span class="pl-k">import</span> <span class="pl-kos">{</span> <span class="pl-s1">createApp</span> <span class="pl-kos">}</span> <span class="pl-k">from</span> <span class="pl-s">"vue"</span><span class="pl-kos">;</span>
<span class="pl-k">import</span> <span class="pl-v">App</span> <span class="pl-k">from</span> <span class="pl-s">"./App.vue"</span><span class="pl-kos">;</span>
<span class="pl-k">import</span> <span class="pl-s1">fullLoadEl</span> <span class="pl-k">from</span> <span class="pl-s">"@/packages/element-plus/fullLoadEl "</span><span class="pl-kos">;</span>

<span class="pl-k">const</span> <span class="pl-s1">app</span> <span class="pl-c1">=</span> <span class="pl-en">createApp</span><span class="pl-kos">(</span><span class="pl-v">App</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-c">// 全局引入</span>
<span class="pl-en">fullLoadEl</span><span class="pl-kos">(</span><span class="pl-s1">app</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-s1">app</span><span class="pl-kos">.</span><span class="pl-en">mount</span><span class="pl-kos">(</span><span class="pl-s">"#app"</span><span class="pl-kos">)</span><span class="pl-kos">;</span></pre></div>
<h2>集成axios</h2>
<h3>安装axios</h3>
<div class="highlight highlight-source-js"><pre class="notranslate"><span class="pl-s1">npm</span> <span class="pl-s1">install</span> <span class="pl-s1">axios</span></pre></div>
<h3>二次封装axios</h3>
<p>参考vben-admin对axios的封装<br>
调用封装的axios类VAxios，传自设参数和项目预设参数的合并对象为参数，生成VAxios实例对象</p>
<div class="highlight highlight-source-js"><pre class="notranslate"><span class="pl-k">import</span> <span class="pl-s1">type</span> <span class="pl-kos">{</span> <span class="pl-v">AxiosResponse</span> <span class="pl-kos">}</span> <span class="pl-k">from</span> <span class="pl-s">"axios"</span><span class="pl-kos">;</span>
<span class="pl-k">import</span> <span class="pl-s1">type</span> <span class="pl-kos">{</span> <span class="pl-v">RequestOptions</span><span class="pl-kos">,</span> <span class="pl-v">Result</span> <span class="pl-kos">}</span> <span class="pl-k">from</span> <span class="pl-s">"./types/axios"</span><span class="pl-kos">;</span>
<span class="pl-c">/*</span>
<span class="pl-c">  export type ErrorMessageMode = "none" | "modal" | "message" | undefined;</span>
<span class="pl-c">  export type SuccessMessageMode = "none" | "message";</span>
<span class="pl-c"></span>
<span class="pl-c">  export interface RequestOptions {</span>
<span class="pl-c">    // Format request parameter time</span>
<span class="pl-c">    formatDate?: boolean;</span>
<span class="pl-c">    // Whether to process the request result</span>
<span class="pl-c">    isTransformResponse?: boolean;</span>
<span class="pl-c">    // Whether to return native response headers</span>
<span class="pl-c">    // For example: use this attribute when you need to get the response headers</span>
<span class="pl-c">    isReturnNativeResponse?: boolean;</span>
<span class="pl-c">    // Error message prompt type</span>
<span class="pl-c">    errorMessageMode?: ErrorMessageMode;</span>
<span class="pl-c">    // Successful request message prompt</span>
<span class="pl-c">    successMessageMode?: SuccessMessageMode;</span>
<span class="pl-c">    // Whether to add a timestamp</span>
<span class="pl-c">    joinTime?: boolean;</span>
<span class="pl-c">    ignoreCancelToken?: boolean;</span>
<span class="pl-c">    // Whether to send token in header</span>
<span class="pl-c">    withToken?: boolean;</span>
<span class="pl-c">    // 请求重试机制</span>
<span class="pl-c">    retryRequest?: RetryRequest;</span>
<span class="pl-c">  }</span>
<span class="pl-c"></span>
<span class="pl-c">  export interface Result&lt;T = any&gt; {</span>
<span class="pl-c">    code: number | string;</span>
<span class="pl-c">    type: "success" | "error" | "warning";</span>
<span class="pl-c">    msg: string;</span>
<span class="pl-c">    data: T;</span>
<span class="pl-c">  }</span>
<span class="pl-c"></span>
<span class="pl-c">  // multipart/form-data: upload file</span>
<span class="pl-c">  export interface UploadFileParams {</span>
<span class="pl-c">    // Other parameters</span>
<span class="pl-c">    data?: Recordable;</span>
<span class="pl-c">    // File parameter interface field name</span>
<span class="pl-c">    name?: string;</span>
<span class="pl-c">    // file name</span>
<span class="pl-c">    file: File | Blob;</span>
<span class="pl-c">    // file name</span>
<span class="pl-c">    filename?: string;</span>
<span class="pl-c">    [key: string]: any;</span>
<span class="pl-c">  }</span>
<span class="pl-c">*/</span>
<span class="pl-k">import</span> <span class="pl-s1">type</span> <span class="pl-kos">{</span> <span class="pl-v">AxiosTransform</span><span class="pl-kos">,</span> <span class="pl-v">CreateAxiosOptions</span> <span class="pl-kos">}</span> <span class="pl-k">from</span> <span class="pl-s">"@/packages/http/axios/axiosTransform"</span><span class="pl-kos">;</span>
<span class="pl-k">import</span> <span class="pl-s1">axios</span> <span class="pl-k">from</span> <span class="pl-s">"axios"</span><span class="pl-kos">;</span>
<span class="pl-k">import</span> <span class="pl-kos">{</span> <span class="pl-s1">clone</span> <span class="pl-kos">}</span> <span class="pl-k">from</span> <span class="pl-s">"lodash-es"</span><span class="pl-kos">;</span>
<span class="pl-k">import</span> <span class="pl-kos">{</span> <span class="pl-v">VAxios</span> <span class="pl-kos">}</span> <span class="pl-k">from</span> <span class="pl-s">"@/packages/http/axios/Axios"</span><span class="pl-kos">;</span>
<span class="pl-k">import</span> <span class="pl-kos">{</span> <span class="pl-s1">checkStatus</span> <span class="pl-kos">}</span> <span class="pl-k">from</span> <span class="pl-s">"@/packages/http/axios/checkStatus"</span><span class="pl-kos">;</span>
<span class="pl-k">import</span> <span class="pl-kos">{</span> <span class="pl-v">AxiosRetry</span> <span class="pl-kos">}</span> <span class="pl-k">from</span> <span class="pl-s">"@/packages/http/axios/axiosRetry"</span><span class="pl-kos">;</span>
<span class="pl-k">import</span> <span class="pl-kos">{</span> <span class="pl-s1">joinTimestamp</span><span class="pl-kos">,</span> <span class="pl-s1">formatRequestDate</span> <span class="pl-kos">}</span> <span class="pl-k">from</span> <span class="pl-s">"@/packages/http/axios/helper"</span><span class="pl-kos">;</span>
<span class="pl-k">import</span> <span class="pl-kos">{</span> <span class="pl-v">RequestEnum</span><span class="pl-kos">,</span> <span class="pl-v">ResultEnum</span><span class="pl-kos">,</span> <span class="pl-v">ContentTypeEnum</span> <span class="pl-kos">}</span> <span class="pl-k">from</span> <span class="pl-s">"@/enums/httpEnum"</span><span class="pl-kos">;</span>
<span class="pl-c">/*</span>
<span class="pl-c"></span>
<span class="pl-c">  // <span class="pl-k">@description</span>: Request result set</span>
<span class="pl-c">  export enum ResultEnum {</span>
<span class="pl-c">    SUCCESS = 200,</span>
<span class="pl-c">    ERROR = -1,</span>
<span class="pl-c">    TIMEOUT = 401,</span>
<span class="pl-c">    TYPE = "success",</span>
<span class="pl-c">  }</span>
<span class="pl-c"></span>
<span class="pl-c">  // <span class="pl-k">@description</span>: request method</span>
<span class="pl-c">  export enum RequestEnum {</span>
<span class="pl-c">    GET = "GET",</span>
<span class="pl-c">    POST = "POST",</span>
<span class="pl-c">    PUT = "PUT",</span>
<span class="pl-c">    DELETE = "DELETE",</span>
<span class="pl-c">  }</span>
<span class="pl-c"></span>
<span class="pl-c">  // <span class="pl-k">@description</span>:  contentType</span>
<span class="pl-c">  export enum ContentTypeEnum {</span>
<span class="pl-c">    // json</span>
<span class="pl-c">    JSON = "application/json;charset=UTF-8",</span>
<span class="pl-c">    // form-data qs</span>
<span class="pl-c">    FORM_URLENCODED = "application/x-www-form-urlencoded;charset=UTF-8",</span>
<span class="pl-c">    // form-data  upload</span>
<span class="pl-c">    FORM_DATA = "multipart/form-data;charset=UTF-8",</span>
<span class="pl-c">  }</span>
<span class="pl-c">*/</span>
<span class="pl-k">import</span> <span class="pl-kos">{</span> <span class="pl-s1">deepMerge</span> <span class="pl-kos">}</span> <span class="pl-k">from</span> <span class="pl-s">"@/utils"</span><span class="pl-kos">;</span>
<span class="pl-c">/*</span>
<span class="pl-c">  export function deepMerge&lt;T = any&gt;(src: any = {}, target: any = {}): T {</span>
<span class="pl-c">    let key: string;</span>
<span class="pl-c">    for (key in target) {</span>
<span class="pl-c">      src[key] = isObject(src[key]) ? deepMerge(src[key], target[key]) : (src[key] = target[key]);</span>
<span class="pl-c">    }</span>
<span class="pl-c">    return src;</span>
<span class="pl-c">  }</span>
<span class="pl-c">*/</span>
<span class="pl-k">import</span> <span class="pl-kos">{</span> <span class="pl-s1">getAppEnvConfig</span> <span class="pl-kos">}</span> <span class="pl-k">from</span> <span class="pl-s">"@/utils/env"</span><span class="pl-kos">;</span>
<span class="pl-c">/* </span>
<span class="pl-c">  // build/getConfigFileName.ts</span>
<span class="pl-c">  export const getConfigFileName = (env: Record&lt;string, any&gt;) =&gt; {</span>
<span class="pl-c">    return `__PRODUCTION__${env.VITE_GLOB_APP_SHORT_NAME || "__APP"}__CONF__`</span>
<span class="pl-c">      .toUpperCase()</span>
<span class="pl-c">      .replace(/\s/g, "");</span>
<span class="pl-c">  };</span>
<span class="pl-c"></span>
<span class="pl-c">  export function getAppEnvConfig() {</span>
<span class="pl-c">    const ENV_NAME = getConfigFileName(import.meta.env);</span>
<span class="pl-c">      </span>
<span class="pl-c">    const ENV = (import.meta.env.DEV</span>
<span class="pl-c">      ? // Get the global configuration (the configuration will be extracted independently when packaging)</span>
<span class="pl-c">        (import.meta.env as unknown as GlobEnvConfig)</span>
<span class="pl-c">      : window[ENV_NAME as any]) as unknown as GlobEnvConfig;</span>
<span class="pl-c"></span>
<span class="pl-c">    const { VITE_GLOB_API_URL } = ENV;</span>
<span class="pl-c"></span>
<span class="pl-c">    return {</span>
<span class="pl-c">      VITE_GLOB_API_URL,</span>
<span class="pl-c">    };</span>
<span class="pl-c"> }</span>
<span class="pl-c">*/</span>
<span class="pl-k">import</span> <span class="pl-kos">{</span> <span class="pl-s1">removeToken，getToken</span> <span class="pl-kos">}</span> <span class="pl-k">from</span> <span class="pl-s">"@/utils/token"</span><span class="pl-kos">;</span>
<span class="pl-c">/*</span>
<span class="pl-c">  import Cookies from "js-cookie";</span>
<span class="pl-c"></span>
<span class="pl-c">  const TokenKey = "Token";</span>
<span class="pl-c"></span>
<span class="pl-c">  export function getToken() {</span>
<span class="pl-c">    return Cookies.get(TokenKey);</span>
<span class="pl-c">  }</span>
<span class="pl-c"></span>
<span class="pl-c">  export function setToken(token: string) {</span>
<span class="pl-c">    return Cookies.set(TokenKey, token);</span>
<span class="pl-c">  }</span>
<span class="pl-c"></span>
<span class="pl-c">  export function removeToken() {</span>
<span class="pl-c">    return Cookies.remove(TokenKey);</span>
<span class="pl-c">  }</span>
<span class="pl-c">*/</span>
<span class="pl-k">import</span> <span class="pl-kos">{</span> <span class="pl-s1">isString</span> <span class="pl-kos">}</span> <span class="pl-k">from</span> <span class="pl-s">"@/utils/is"</span><span class="pl-kos">;</span>
<span class="pl-c">/*</span>
<span class="pl-c">  const toString = Object.prototype.toString;</span>
<span class="pl-c"></span>
<span class="pl-c">  export function is(val: unknown, type: string) {</span>
<span class="pl-c">    return toString.call(val) === `[object ${type}]`;</span>
<span class="pl-c">  }</span>
<span class="pl-c">  </span>
<span class="pl-c">  export function isString(val: unknown): val is string {</span>
<span class="pl-c">    return is(val, "String");</span>
<span class="pl-c">  }</span>
<span class="pl-c">*/</span>
<span class="pl-k">import</span> <span class="pl-kos">{</span> <span class="pl-s1">useUserStoreWithOut</span> <span class="pl-kos">}</span> <span class="pl-k">from</span> <span class="pl-s">"$store/user"</span><span class="pl-kos">;</span>
<span class="pl-k">import</span> <span class="pl-kos">{</span> <span class="pl-v">ElMessage</span><span class="pl-kos">,</span> <span class="pl-v">ElMessageBox</span> <span class="pl-kos">}</span> <span class="pl-k">from</span> <span class="pl-s">"element-plus"</span><span class="pl-kos">;</span>
<span class="pl-k">import</span> <span class="pl-kos">{</span> <span class="pl-s1">s</span> <span class="pl-kos">}</span> <span class="pl-k">from</span> <span class="pl-s">"$locale"</span><span class="pl-kos">;</span>

<span class="pl-k">const</span> <span class="pl-kos">{</span> <span class="pl-c1">VITE_GLOB_API_URL</span> <span class="pl-kos">}</span> <span class="pl-c1">=</span> <span class="pl-en">getAppEnvConfig</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-k">const</span> <span class="pl-s1">transform</span>: <span class="pl-v">AxiosTransform</span> <span class="pl-c1">=</span> <span class="pl-kos">{</span>
  <span class="pl-c">/**</span>
<span class="pl-c">   * <span class="pl-k">@description</span>: 处理响应数据。如果数据不是预期格式，可直接抛出错误</span>
<span class="pl-c">   */</span>
  <span class="pl-en">transformResponseHook</span>: <span class="pl-kos">(</span><span class="pl-s1">res</span>: <span class="pl-v">AxiosResponse</span><span class="pl-c1">&lt;</span><span class="pl-v">Result</span><span class="pl-c1">&gt;</span><span class="pl-kos">,</span> <span class="pl-s1">options</span>: <span class="pl-v">RequestOptions</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-kos">{</span>
    <span class="pl-k">const</span> <span class="pl-kos">{</span> isTransformResponse<span class="pl-kos">,</span> isReturnNativeResponse<span class="pl-kos">,</span> successMessageMode <span class="pl-kos">}</span> <span class="pl-c1">=</span> <span class="pl-s1">options</span><span class="pl-kos">;</span>
    <span class="pl-c">// 是否返回原生响应头 比如：需要获取响应头时使用该属性</span>
    <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-s1">isReturnNativeResponse</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
      <span class="pl-k">return</span> <span class="pl-s1">res</span><span class="pl-kos">;</span>
    <span class="pl-kos">}</span>
    <span class="pl-c">// 不进行任何处理，直接返回</span>
    <span class="pl-c">// 用于页面代码可能需要直接获取code，data，message这些信息时开启</span>
    <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-c1">!</span><span class="pl-s1">isTransformResponse</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
      <span class="pl-k">return</span> <span class="pl-s1">res</span><span class="pl-kos">.</span><span class="pl-c1">data</span><span class="pl-kos">;</span>
    <span class="pl-kos">}</span>
    <span class="pl-c">// 错误的时候返回</span>
    <span class="pl-k">const</span> <span class="pl-s1">result</span> <span class="pl-c1">=</span> <span class="pl-s1">res</span><span class="pl-kos">.</span><span class="pl-c1">data</span><span class="pl-kos">;</span>
    <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-c1">!</span><span class="pl-s1">result</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
      <span class="pl-c">// return '[HTTP] Request has no return value';</span>
      <span class="pl-k">throw</span> <span class="pl-k">new</span> <span class="pl-v">Error</span><span class="pl-kos">(</span><span class="pl-en">s</span><span class="pl-kos">(</span><span class="pl-s">"请求出错，请稍后重试"</span><span class="pl-kos">)</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-kos">}</span>
    <span class="pl-c">//  这里 code，result，message为 后台统一的字段，需要在 types.ts内修改为项目自己的接口返回格式</span>
    <span class="pl-k">const</span> <span class="pl-kos">{</span> code<span class="pl-kos">,</span> data<span class="pl-kos">,</span> msg <span class="pl-kos">}</span> <span class="pl-c1">=</span> <span class="pl-s1">result</span><span class="pl-kos">;</span>

    <span class="pl-c">// 这里逻辑可以根据项目进行修改</span>
    <span class="pl-k">const</span> <span class="pl-s1">hasSuccess</span> <span class="pl-c1">=</span> <span class="pl-s1">result</span> <span class="pl-c1">&amp;&amp;</span> <span class="pl-v">Reflect</span><span class="pl-kos">.</span><span class="pl-en">has</span><span class="pl-kos">(</span><span class="pl-s1">result</span><span class="pl-kos">,</span> <span class="pl-s">"code"</span><span class="pl-kos">)</span> <span class="pl-c1">&amp;&amp;</span> <span class="pl-s1">code</span> <span class="pl-c1">===</span> <span class="pl-v">ResultEnum</span><span class="pl-kos">.</span><span class="pl-c1">SUCCESS</span><span class="pl-kos">;</span>
    <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-s1">hasSuccess</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
      <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-s1">successMessageMode</span> <span class="pl-c1">===</span> <span class="pl-s">"message"</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
        <span class="pl-v">ElMessage</span><span class="pl-kos">(</span><span class="pl-kos">{</span>
          <span class="pl-c1">message</span>: <span class="pl-s1">result</span><span class="pl-kos">.</span><span class="pl-c1">msg</span><span class="pl-kos">,</span>
          <span class="pl-c1">type</span>: <span class="pl-s">"success"</span><span class="pl-kos">,</span>
        <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
      <span class="pl-kos">}</span>
      <span class="pl-k">return</span> <span class="pl-s1">data</span><span class="pl-kos">;</span>
    <span class="pl-kos">}</span>

    <span class="pl-c">// 在此处根据自己项目的实际情况对不同的code执行不同的操作</span>
    <span class="pl-c">// 如果不希望中断当前请求，请return数据，否则直接抛出异常即可</span>
    <span class="pl-k">let</span> <span class="pl-s1">timeoutMsg</span> <span class="pl-c1">=</span> <span class="pl-s">""</span><span class="pl-kos">;</span>
    <span class="pl-k">switch</span> <span class="pl-kos">(</span><span class="pl-s1">code</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
      <span class="pl-k">case</span> <span class="pl-v">ResultEnum</span><span class="pl-kos">.</span><span class="pl-c1">TIMEOUT</span>:
        <span class="pl-s1">timeoutMsg</span> <span class="pl-c1">=</span> <span class="pl-en">s</span><span class="pl-kos">(</span><span class="pl-s">"登录超时，请重新登录！"</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
        <span class="pl-k">const</span> <span class="pl-s1">userStore</span> <span class="pl-c1">=</span> <span class="pl-en">useUserStoreWithOut</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
        <span class="pl-en">removeToken</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
        <span class="pl-s1">userStore</span><span class="pl-kos">.</span><span class="pl-en">Logout</span><span class="pl-kos">(</span><span class="pl-c1">true</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
        <span class="pl-k">break</span><span class="pl-kos">;</span>
      <span class="pl-k">default</span>:
        <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-s1">msg</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
          <span class="pl-s1">timeoutMsg</span> <span class="pl-c1">=</span> <span class="pl-s1">msg</span><span class="pl-kos">;</span>
        <span class="pl-kos">}</span>
    <span class="pl-kos">}</span>

    <span class="pl-c">// token过期的操作</span>
    <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-s1">timeoutMsg</span> <span class="pl-c1">===</span> <span class="pl-s">"登录过期，请重新登录!"</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
      <span class="pl-v">ElMessageBox</span><span class="pl-kos">(</span><span class="pl-kos">{</span>
        <span class="pl-c1">type</span>: <span class="pl-s">"error"</span><span class="pl-kos">,</span>
        <span class="pl-c1">title</span>: <span class="pl-en">s</span><span class="pl-kos">(</span><span class="pl-s">"错误提示"</span><span class="pl-kos">)</span><span class="pl-kos">,</span>
        <span class="pl-c1">message</span>: <span class="pl-s1">timeoutMsg</span><span class="pl-kos">,</span>
        <span class="pl-c1">confirmButtonText</span>: <span class="pl-en">s</span><span class="pl-kos">(</span><span class="pl-s">"确认"</span><span class="pl-kos">)</span><span class="pl-kos">,</span>
        <span class="pl-en">callback</span>: <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">action</span>: <span class="pl-s1">string</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
          <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-s1">action</span> <span class="pl-c1">===</span> <span class="pl-s">"confirm"</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
            <span class="pl-en">removeToken</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
            <span class="pl-k">const</span> <span class="pl-s1">userStore</span> <span class="pl-c1">=</span> <span class="pl-en">useUserStoreWithOut</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
            <span class="pl-s1">userStore</span><span class="pl-kos">.</span><span class="pl-en">Logout</span><span class="pl-kos">(</span><span class="pl-c1">true</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
          <span class="pl-kos">}</span>
        <span class="pl-kos">}</span><span class="pl-kos">,</span>
      <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
      <span class="pl-k">return</span><span class="pl-kos">;</span>
    <span class="pl-kos">}</span>

    <span class="pl-c">// errorMessageMode=‘modal’的时候会显示modal错误弹窗，而不是消息提示，用于一些比较重要的错误</span>
    <span class="pl-c">// errorMessageMode='none' 一般是调用时明确表示不希望自动弹出错误提示</span>
    <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-s1">options</span><span class="pl-kos">.</span><span class="pl-c1">errorMessageMode</span> <span class="pl-c1">===</span> <span class="pl-s">"modal"</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
      <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-s1">timeoutMsg</span> <span class="pl-c1">===</span> <span class="pl-s">"登录过期，请重新登录!"</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
        <span class="pl-v">ElMessageBox</span><span class="pl-kos">(</span><span class="pl-kos">{</span>
          <span class="pl-c1">type</span>: <span class="pl-s">"error"</span><span class="pl-kos">,</span>
          <span class="pl-c1">title</span>: <span class="pl-en">s</span><span class="pl-kos">(</span><span class="pl-s">"错误提示"</span><span class="pl-kos">)</span><span class="pl-kos">,</span>
          <span class="pl-c1">message</span>: <span class="pl-s1">timeoutMsg</span><span class="pl-kos">,</span>
          <span class="pl-c1">confirmButtonText</span>: <span class="pl-en">s</span><span class="pl-kos">(</span><span class="pl-s">"确认"</span><span class="pl-kos">)</span><span class="pl-kos">,</span>
          <span class="pl-en">callback</span>: <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">action</span>: <span class="pl-s1">string</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
            <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-s1">action</span> <span class="pl-c1">===</span> <span class="pl-s">"confirm"</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
              <span class="pl-en">removeToken</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
              <span class="pl-k">const</span> <span class="pl-s1">userStore</span> <span class="pl-c1">=</span> <span class="pl-en">useUserStoreWithOut</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
              <span class="pl-s1">userStore</span><span class="pl-kos">.</span><span class="pl-en">Logout</span><span class="pl-kos">(</span><span class="pl-c1">true</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
            <span class="pl-kos">}</span>
          <span class="pl-kos">}</span><span class="pl-kos">,</span>
        <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
      <span class="pl-kos">}</span> <span class="pl-k">else</span> <span class="pl-kos">{</span>
        <span class="pl-v">ElMessageBox</span><span class="pl-kos">(</span><span class="pl-kos">{</span>
          <span class="pl-c1">type</span>: <span class="pl-s">"error"</span><span class="pl-kos">,</span>
          <span class="pl-c1">title</span>: <span class="pl-en">s</span><span class="pl-kos">(</span><span class="pl-s">"错误提示"</span><span class="pl-kos">)</span><span class="pl-kos">,</span>
          <span class="pl-c1">message</span>: <span class="pl-s1">timeoutMsg</span><span class="pl-kos">,</span>
          <span class="pl-c1">confirmButtonText</span>: <span class="pl-en">s</span><span class="pl-kos">(</span><span class="pl-s">"确认"</span><span class="pl-kos">)</span><span class="pl-kos">,</span>
        <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
      <span class="pl-kos">}</span>
    <span class="pl-kos">}</span> <span class="pl-k">else</span> <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-s1">options</span><span class="pl-kos">.</span><span class="pl-c1">errorMessageMode</span> <span class="pl-c1">===</span> <span class="pl-s">"message"</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
      <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-s1">timeoutMsg</span> <span class="pl-c1">===</span> <span class="pl-s">"登录过期，请重新登录!"</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
        <span class="pl-v">ElMessageBox</span><span class="pl-kos">(</span><span class="pl-kos">{</span>
          <span class="pl-c1">type</span>: <span class="pl-s">"error"</span><span class="pl-kos">,</span>
          <span class="pl-c1">title</span>: <span class="pl-en">s</span><span class="pl-kos">(</span><span class="pl-s">"错误提示"</span><span class="pl-kos">)</span><span class="pl-kos">,</span>
          <span class="pl-c1">message</span>: <span class="pl-s1">timeoutMsg</span><span class="pl-kos">,</span>
          <span class="pl-c1">confirmButtonText</span>: <span class="pl-en">s</span><span class="pl-kos">(</span><span class="pl-s">"确认"</span><span class="pl-kos">)</span><span class="pl-kos">,</span>
          <span class="pl-en">callback</span>: <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">action</span>: <span class="pl-s1">string</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
            <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-s1">action</span> <span class="pl-c1">===</span> <span class="pl-s">"confirm"</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
              <span class="pl-en">removeToken</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
              <span class="pl-k">const</span> <span class="pl-s1">userStore</span> <span class="pl-c1">=</span> <span class="pl-en">useUserStoreWithOut</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
              <span class="pl-s1">userStore</span><span class="pl-kos">.</span><span class="pl-en">Logout</span><span class="pl-kos">(</span><span class="pl-c1">true</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
            <span class="pl-kos">}</span>
          <span class="pl-kos">}</span><span class="pl-kos">,</span>
        <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
      <span class="pl-kos">}</span> <span class="pl-k">else</span> <span class="pl-kos">{</span>
        <span class="pl-v">ElMessage</span><span class="pl-kos">.</span><span class="pl-en">error</span><span class="pl-kos">(</span><span class="pl-s1">timeoutMsg</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
      <span class="pl-kos">}</span>
    <span class="pl-kos">}</span>

    <span class="pl-k">throw</span> <span class="pl-k">new</span> <span class="pl-v">Error</span><span class="pl-kos">(</span><span class="pl-s1">timeoutMsg</span> <span class="pl-c1">||</span> <span class="pl-en">s</span><span class="pl-kos">(</span><span class="pl-s">"请求出错，请稍后重试"</span><span class="pl-kos">)</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
  <span class="pl-kos">}</span><span class="pl-kos">,</span>

  <span class="pl-c">// 请求之前处理config</span>
  <span class="pl-en">beforeRequestHook</span>: <span class="pl-kos">(</span><span class="pl-s1">config</span><span class="pl-kos">,</span> <span class="pl-s1">options</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-kos">{</span>
    <span class="pl-k">const</span> <span class="pl-kos">{</span> formatDate<span class="pl-kos">,</span> joinTime <span class="pl-c1">=</span> <span class="pl-c1">true</span> <span class="pl-kos">}</span> <span class="pl-c1">=</span> <span class="pl-s1">options</span><span class="pl-kos">;</span>

    <span class="pl-k">const</span> <span class="pl-s1">params</span> <span class="pl-c1">=</span> <span class="pl-s1">config</span><span class="pl-kos">.</span><span class="pl-c1">params</span> <span class="pl-c1">||</span> <span class="pl-kos">{</span><span class="pl-kos">}</span><span class="pl-kos">;</span>
    <span class="pl-k">const</span> <span class="pl-s1">data</span> <span class="pl-c1">=</span> <span class="pl-s1">config</span><span class="pl-kos">.</span><span class="pl-c1">data</span> <span class="pl-c1">||</span> <span class="pl-c1">false</span><span class="pl-kos">;</span>
    <span class="pl-s1">formatDate</span> <span class="pl-c1">&amp;&amp;</span> <span class="pl-s1">data</span> <span class="pl-c1">&amp;&amp;</span> <span class="pl-c1">!</span><span class="pl-en">isString</span><span class="pl-kos">(</span><span class="pl-s1">data</span><span class="pl-kos">)</span> <span class="pl-c1">&amp;&amp;</span> <span class="pl-en">formatRequestDate</span><span class="pl-kos">(</span><span class="pl-s1">data</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-s1">config</span><span class="pl-kos">.</span><span class="pl-c1">method</span><span class="pl-kos">?.</span><span class="pl-en">toUpperCase</span><span class="pl-kos">(</span><span class="pl-kos">)</span> <span class="pl-c1">===</span> <span class="pl-v">RequestEnum</span><span class="pl-kos">.</span><span class="pl-c1">GET</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
      <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-c1">!</span><span class="pl-en">isString</span><span class="pl-kos">(</span><span class="pl-s1">params</span><span class="pl-kos">)</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
        <span class="pl-c">// 给 get 请求加上时间戳参数，避免从缓存中拿数据。</span>
        <span class="pl-s1">config</span><span class="pl-kos">.</span><span class="pl-c1">params</span> <span class="pl-c1">=</span> <span class="pl-v">Object</span><span class="pl-kos">.</span><span class="pl-en">assign</span><span class="pl-kos">(</span><span class="pl-s1">params</span> <span class="pl-c1">||</span> <span class="pl-kos">{</span><span class="pl-kos">}</span><span class="pl-kos">,</span> <span class="pl-en">joinTimestamp</span><span class="pl-kos">(</span><span class="pl-s1">joinTime</span><span class="pl-kos">,</span> <span class="pl-c1">false</span><span class="pl-kos">)</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
      <span class="pl-kos">}</span> <span class="pl-k">else</span> <span class="pl-kos">{</span>
        <span class="pl-c">// 兼容restful风格</span>
        <span class="pl-s1">config</span><span class="pl-kos">.</span><span class="pl-c1">url</span> <span class="pl-c1">=</span> <span class="pl-s1">config</span><span class="pl-kos">.</span><span class="pl-c1">url</span> <span class="pl-c1">+</span> <span class="pl-s1">params</span> <span class="pl-c1">+</span> <span class="pl-s">`<span class="pl-s1"><span class="pl-kos">${</span><span class="pl-en">joinTimestamp</span><span class="pl-kos">(</span><span class="pl-s1">joinTime</span><span class="pl-kos">,</span> <span class="pl-c1">true</span><span class="pl-kos">)</span><span class="pl-kos">}</span></span>`</span><span class="pl-kos">;</span>
        <span class="pl-s1">config</span><span class="pl-kos">.</span><span class="pl-c1">params</span> <span class="pl-c1">=</span> <span class="pl-c1">undefined</span><span class="pl-kos">;</span>
      <span class="pl-kos">}</span>
    <span class="pl-kos">}</span> <span class="pl-k">else</span> <span class="pl-kos">{</span>
      <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-c1">!</span><span class="pl-en">isString</span><span class="pl-kos">(</span><span class="pl-s1">params</span><span class="pl-kos">)</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
        <span class="pl-s1">formatDate</span> <span class="pl-c1">&amp;&amp;</span> <span class="pl-en">formatRequestDate</span><span class="pl-kos">(</span><span class="pl-s1">params</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
        <span class="pl-k">if</span> <span class="pl-kos">(</span>
          <span class="pl-v">Reflect</span><span class="pl-kos">.</span><span class="pl-en">has</span><span class="pl-kos">(</span><span class="pl-s1">config</span><span class="pl-kos">,</span> <span class="pl-s">"data"</span><span class="pl-kos">)</span> <span class="pl-c1">&amp;&amp;</span>
          <span class="pl-s1">config</span><span class="pl-kos">.</span><span class="pl-c1">data</span> <span class="pl-c1">&amp;&amp;</span>
          <span class="pl-kos">(</span><span class="pl-v">Object</span><span class="pl-kos">.</span><span class="pl-en">keys</span><span class="pl-kos">(</span><span class="pl-s1">config</span><span class="pl-kos">.</span><span class="pl-c1">data</span><span class="pl-kos">)</span><span class="pl-kos">.</span><span class="pl-c1">length</span> <span class="pl-c1">&gt;</span> <span class="pl-c1">0</span> <span class="pl-c1">||</span> <span class="pl-s1">config</span><span class="pl-kos">.</span><span class="pl-c1">data</span> <span class="pl-k">instanceof</span> <span class="pl-v">FormData</span><span class="pl-kos">)</span>
        <span class="pl-kos">)</span> <span class="pl-kos">{</span>
          <span class="pl-s1">config</span><span class="pl-kos">.</span><span class="pl-c1">data</span> <span class="pl-c1">=</span> <span class="pl-s1">data</span><span class="pl-kos">;</span>
          <span class="pl-s1">config</span><span class="pl-kos">.</span><span class="pl-c1">params</span> <span class="pl-c1">=</span> <span class="pl-s1">params</span><span class="pl-kos">;</span>
        <span class="pl-kos">}</span> <span class="pl-k">else</span> <span class="pl-kos">{</span>
          <span class="pl-c">// 非GET请求如果没有提供data，则将params视为data</span>
          <span class="pl-s1">config</span><span class="pl-kos">.</span><span class="pl-c1">data</span> <span class="pl-c1">=</span> <span class="pl-s1">params</span><span class="pl-kos">;</span>
          <span class="pl-s1">config</span><span class="pl-kos">.</span><span class="pl-c1">params</span> <span class="pl-c1">=</span> <span class="pl-c1">undefined</span><span class="pl-kos">;</span>
        <span class="pl-kos">}</span>
      <span class="pl-kos">}</span> <span class="pl-k">else</span> <span class="pl-kos">{</span>
        <span class="pl-c">// 兼容restful风格</span>
        <span class="pl-s1">config</span><span class="pl-kos">.</span><span class="pl-c1">url</span> <span class="pl-c1">=</span> <span class="pl-s1">config</span><span class="pl-kos">.</span><span class="pl-c1">url</span> <span class="pl-c1">+</span> <span class="pl-s1">params</span><span class="pl-kos">;</span>
        <span class="pl-s1">config</span><span class="pl-kos">.</span><span class="pl-c1">params</span> <span class="pl-c1">=</span> <span class="pl-c1">undefined</span><span class="pl-kos">;</span>
      <span class="pl-kos">}</span>
    <span class="pl-kos">}</span>
    <span class="pl-k">return</span> <span class="pl-s1">config</span><span class="pl-kos">;</span>
  <span class="pl-kos">}</span><span class="pl-kos">,</span>

  <span class="pl-c">/**</span>
<span class="pl-c">   * <span class="pl-k">@description</span>: 请求拦截器处理</span>
<span class="pl-c">   */</span>
  <span class="pl-en">requestInterceptors</span>: <span class="pl-kos">(</span><span class="pl-s1">config</span><span class="pl-kos">,</span> <span class="pl-s1">options</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-kos">{</span>
    <span class="pl-c">// 请求之前处理config</span>
    <span class="pl-k">const</span> <span class="pl-s1">token</span> <span class="pl-c1">=</span> <span class="pl-en">getToken</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-s1">token</span> <span class="pl-c1">&amp;&amp;</span> <span class="pl-kos">(</span><span class="pl-s1">config</span> <span class="pl-s1">as</span> <span class="pl-v">Recordable</span><span class="pl-kos">)</span><span class="pl-kos">?.</span><span class="pl-c1">requestOptions</span><span class="pl-kos">?.</span><span class="pl-c1">withToken</span> <span class="pl-c1">!==</span> <span class="pl-c1">false</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
      <span class="pl-c">// jwt token</span>
      <span class="pl-kos">(</span><span class="pl-s1">config</span> <span class="pl-s1">as</span> <span class="pl-v">Recordable</span><span class="pl-kos">)</span><span class="pl-kos">.</span><span class="pl-c1">headers</span><span class="pl-kos">.</span><span class="pl-c1">Authorization</span> <span class="pl-c1">=</span> <span class="pl-s1">options</span><span class="pl-kos">.</span><span class="pl-c1">authenticationScheme</span>
        ? <span class="pl-s">`<span class="pl-s1"><span class="pl-kos">${</span><span class="pl-s1">options</span><span class="pl-kos">.</span><span class="pl-c1">authenticationScheme</span><span class="pl-kos">}</span></span> <span class="pl-s1"><span class="pl-kos">${</span><span class="pl-s1">token</span><span class="pl-kos">}</span></span>`</span>
        : <span class="pl-s1">token</span><span class="pl-kos">;</span>
    <span class="pl-kos">}</span>
    <span class="pl-k">return</span> <span class="pl-s1">config</span><span class="pl-kos">;</span>
  <span class="pl-kos">}</span><span class="pl-kos">,</span>

  <span class="pl-c">/**</span>
<span class="pl-c">   * <span class="pl-k">@description</span>: 响应拦截器处理</span>
<span class="pl-c">   */</span>
  <span class="pl-en">responseInterceptors</span>: <span class="pl-kos">(</span><span class="pl-s1">res</span>: <span class="pl-v">AxiosResponse</span><span class="pl-c1">&lt;</span><span class="pl-s1">any</span><span class="pl-c1">&gt;</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-kos">{</span>
    <span class="pl-k">return</span> <span class="pl-s1">res</span><span class="pl-kos">;</span>
  <span class="pl-kos">}</span><span class="pl-kos">,</span>

  <span class="pl-c">/**</span>
<span class="pl-c">   * <span class="pl-k">@description</span>: 响应错误处理</span>
<span class="pl-c">   */</span>
  <span class="pl-c1">responseInterceptorsCatch</span>: <span class="pl-kos">(</span><span class="pl-s1">axiosInstance</span>: <span class="pl-v">AxiosResponse</span><span class="pl-kos">,</span> <span class="pl-c1">error</span>: <span class="pl-s1">any</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-kos">{</span>
    <span class="pl-s1">const</span> <span class="pl-kos">{</span> response<span class="pl-kos">,</span> code<span class="pl-kos">,</span> message<span class="pl-kos">,</span> config <span class="pl-kos">}</span> <span class="pl-c1">=</span> <span class="pl-s1">error</span> <span class="pl-c1">||</span> <span class="pl-kos">{</span><span class="pl-kos">}</span><span class="pl-kos">;</span>
    <span class="pl-k">const</span> <span class="pl-s1">errorMessageMode</span> <span class="pl-c1">=</span> <span class="pl-s1">config</span><span class="pl-kos">?.</span><span class="pl-c1">requestOptions</span><span class="pl-kos">?.</span><span class="pl-c1">errorMessageMode</span> <span class="pl-c1">||</span> <span class="pl-s">"none"</span><span class="pl-kos">;</span>
    <span class="pl-k">const</span> <span class="pl-s1">msg</span>: <span class="pl-s1">string</span> <span class="pl-c1">=</span> <span class="pl-s1">response</span><span class="pl-kos">?.</span><span class="pl-c1">data</span><span class="pl-kos">?.</span><span class="pl-c1">error</span><span class="pl-kos">?.</span><span class="pl-c1">message</span> <span class="pl-c1">??</span> <span class="pl-s">""</span><span class="pl-kos">;</span>
    <span class="pl-k">const</span> <span class="pl-s1">err</span>: <span class="pl-s1">string</span> <span class="pl-c1">=</span> <span class="pl-s1">error</span><span class="pl-kos">?.</span><span class="pl-en">toString</span><span class="pl-kos">?.</span><span class="pl-kos">(</span><span class="pl-kos">)</span> <span class="pl-c1">??</span> <span class="pl-s">""</span><span class="pl-kos">;</span>
    <span class="pl-k">let</span> <span class="pl-s1">errMessage</span> <span class="pl-c1">=</span> <span class="pl-s">""</span><span class="pl-kos">;</span>

    <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-s1">axios</span><span class="pl-kos">.</span><span class="pl-en">isCancel</span><span class="pl-kos">(</span><span class="pl-s1">error</span><span class="pl-kos">)</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
      <span class="pl-en">return</span> <span class="pl-v">Promise</span><span class="pl-kos">.</span><span class="pl-s1">reject</span><span class="pl-kos">(</span><span class="pl-s1">error</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-kos">}</span>

    <span class="pl-k">try</span> <span class="pl-kos">{</span>
      <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-s1">code</span> <span class="pl-c1">===</span> <span class="pl-s">"ECONNABORTED"</span> <span class="pl-c1">&amp;&amp;</span> <span class="pl-s1">message</span><span class="pl-kos">.</span><span class="pl-en">indexOf</span><span class="pl-kos">(</span><span class="pl-s">"timeout"</span><span class="pl-kos">)</span> <span class="pl-c1">!==</span> <span class="pl-c1">-</span><span class="pl-c1">1</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
        <span class="pl-s1">errMessage</span> <span class="pl-c1">=</span> <span class="pl-en">s</span><span class="pl-kos">(</span><span class="pl-s">"接口请求超时，请刷新页面重试！"</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
      <span class="pl-kos">}</span>
      <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-s1">err</span><span class="pl-kos">?.</span><span class="pl-en">includes</span><span class="pl-kos">(</span><span class="pl-s">"Network Error"</span><span class="pl-kos">)</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
        <span class="pl-s1">errMessage</span> <span class="pl-c1">=</span> <span class="pl-en">s</span><span class="pl-kos">(</span><span class="pl-s">"网络异常，请检查您的网络连接是否正常！"</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
      <span class="pl-kos">}</span>

      <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-s1">errMessage</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
        <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-s1">errorMessageMode</span> <span class="pl-c1">===</span> <span class="pl-s">"modal"</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
          <span class="pl-v">ElMessageBox</span><span class="pl-kos">(</span><span class="pl-kos">{</span>
            <span class="pl-c1">type</span>: <span class="pl-s">"error"</span><span class="pl-kos">,</span>
            <span class="pl-c1">title</span>: <span class="pl-en">s</span><span class="pl-kos">(</span><span class="pl-s">"错误提示"</span><span class="pl-kos">)</span><span class="pl-kos">,</span>
            <span class="pl-c1">message</span>: <span class="pl-s1">errMessage</span><span class="pl-kos">,</span>
            <span class="pl-c1">confirmButtonText</span>: <span class="pl-en">s</span><span class="pl-kos">(</span><span class="pl-s">"确认"</span><span class="pl-kos">)</span><span class="pl-kos">,</span>
          <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
        <span class="pl-kos">}</span> <span class="pl-k">else</span> <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-s1">errorMessageMode</span> <span class="pl-c1">===</span> <span class="pl-s">"message"</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
          <span class="pl-v">ElMessage</span><span class="pl-kos">.</span><span class="pl-en">error</span><span class="pl-kos">(</span><span class="pl-s1">errMessage</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
        <span class="pl-kos">}</span>
        <span class="pl-k">return</span> <span class="pl-v">Promise</span><span class="pl-kos">.</span><span class="pl-en">reject</span><span class="pl-kos">(</span><span class="pl-s1">error</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
      <span class="pl-kos">}</span>
    <span class="pl-kos">}</span> <span class="pl-s1">catch</span> <span class="pl-kos">(</span><span class="pl-s1">error</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
      <span class="pl-k">throw</span> <span class="pl-k">new</span> <span class="pl-v">Error</span><span class="pl-kos">(</span><span class="pl-s1">error</span> <span class="pl-k">as</span> <span class="pl-s1">unknown</span> <span class="pl-k">as</span> <span class="pl-s1">string</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-kos">}</span>

    <span class="pl-s1">checkStatus</span><span class="pl-kos">(</span><span class="pl-s1">error</span><span class="pl-kos">?.</span><span class="pl-c1">response</span><span class="pl-kos">?.</span><span class="pl-c1">status</span><span class="pl-kos">,</span> <span class="pl-s1">msg</span><span class="pl-kos">,</span> <span class="pl-s1">errorMessageMode</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

    <span class="pl-c">// 添加自动重试机制 保险起见 只针对GET请求</span>
    <span class="pl-k">const</span> <span class="pl-s1">retryRequest</span> <span class="pl-c1">=</span> <span class="pl-k">new</span> <span class="pl-v">AxiosRetry</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-k">const</span> <span class="pl-kos">{</span> <span class="pl-s1">isOpenRetry</span> <span class="pl-kos">}</span> <span class="pl-c1">=</span> <span class="pl-s1">config</span><span class="pl-kos">.</span><span class="pl-c1">requestOptions</span><span class="pl-kos">.</span><span class="pl-c1">retryRequest</span><span class="pl-kos"></span><span class="pl-kos">;</span>
    <span class="pl-s1">config</span><span class="pl-kos">.</span><span class="pl-c1">method</span><span class="pl-kos">?.</span><span class="pl-en">toUpperCase</span><span class="pl-kos">(</span><span class="pl-kos">)</span> <span class="pl-c1">===</span> <span class="pl-v">RequestEnum</span><span class="pl-kos">.</span><span class="pl-c1">GET</span> <span class="pl-c1">&amp;&amp;</span>
      <span class="pl-s1">isOpenRetry</span> <span class="pl-c1">&amp;&amp;</span>
      <span class="pl-c">// <span class="pl-k">@ts</span>-ignore</span>
      <span class="pl-s1">retryRequest</span><span class="pl-kos">.</span><span class="pl-en">retry</span><span class="pl-kos">(</span><span class="pl-s1">axiosInstance</span><span class="pl-kos">,</span> <span class="pl-s1">error</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-k">return</span> <span class="pl-v">Promise</span><span class="pl-kos">.</span><span class="pl-en">reject</span><span class="pl-kos">(</span><span class="pl-s1">error</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
  <span class="pl-kos">}</span><span class="pl-kos">,</span>
<span class="pl-kos">}</span><span class="pl-kos">;</span>

<span class="pl-k">function</span> <span class="pl-s1">createAxios</span><span class="pl-kos">(</span><span class="pl-s1">opt</span>?: <span class="pl-v">Partial</span><span class="pl-c1">&lt;</span><span class="pl-v">CreateAxiosOptions</span><span class="pl-c1">&gt;</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
  <span class="pl-s1">return</span> <span class="pl-s1">new</span> <span class="pl-c1">VAxios</span><span class="pl-kos">(</span>
    <span class="pl-en">deepMerge</span><span class="pl-kos">(</span>
      <span class="pl-kos">{</span>
        <span class="pl-c1">authenticationScheme</span>: <span class="pl-s">"Bearer"</span><span class="pl-kos">,</span>
        <span class="pl-c1">timeout</span>: <span class="pl-c1">10</span> <span class="pl-c1">*</span> <span class="pl-c1">1000</span><span class="pl-kos">,</span>
        <span class="pl-c">// 基础接口地址</span>
        <span class="pl-c1">baseURL</span>: <span class="pl-s">"basic-api"</span><span class="pl-kos">,</span>
        <span class="pl-c1">headers</span>: <span class="pl-kos">{</span> <span class="pl-s">"Content-Type"</span>: <span class="pl-v">ContentTypeEnum</span><span class="pl-kos">.</span><span class="pl-c1">JSON</span> <span class="pl-kos">}</span><span class="pl-kos">,</span>
        <span class="pl-c">// 数据处理方式 clone——克隆，对象的深拷贝</span>
        <span class="pl-c1">transform</span>: <span class="pl-en">clone</span><span class="pl-kos">(</span><span class="pl-s1">transform</span><span class="pl-kos">)</span><span class="pl-kos">,</span>

        <span class="pl-c1">requestOptions</span>: <span class="pl-kos">{</span>
          <span class="pl-c">// 是否返回原生响应头 比如：需要获取响应头时使用该属性</span>
          <span class="pl-c1">isReturnNativeResponse</span>: <span class="pl-c1">false</span><span class="pl-kos">,</span>
          <span class="pl-c">// 需要对返回数据进行处理</span>
          <span class="pl-c1">isTransformResponse</span>: <span class="pl-c1">true</span><span class="pl-kos">,</span>
          <span class="pl-c">// 格式化提交参数时间</span>
          <span class="pl-c1">formatDate</span>: <span class="pl-c1">true</span><span class="pl-kos">,</span>
          <span class="pl-c">// 消息提示类型</span>
          <span class="pl-c1">errorMessageMode</span>: <span class="pl-s">"message"</span><span class="pl-kos">,</span>
          <span class="pl-c">// 成功请求消息提示</span>
          <span class="pl-c1">successMessageMode</span>: <span class="pl-s">"message"</span><span class="pl-kos">,</span>
          <span class="pl-c">//  是否加入时间戳</span>
          <span class="pl-c1">joinTime</span>: <span class="pl-c1">true</span><span class="pl-kos">,</span>
          <span class="pl-c">// 忽略重复请求</span>
          <span class="pl-c1">ignoreCancelToken</span>: <span class="pl-c1">true</span><span class="pl-kos">,</span>
          <span class="pl-c">// 是否携带token</span>
          <span class="pl-c1">withToken</span>: <span class="pl-c1">true</span><span class="pl-kos">,</span>
          <span class="pl-c1">retryRequest</span>: <span class="pl-kos">{</span>
            <span class="pl-c1">isOpenRetry</span>: <span class="pl-c1">true</span><span class="pl-kos">,</span>
            <span class="pl-c1">count</span>: <span class="pl-c1">5</span><span class="pl-kos">,</span>
            <span class="pl-c1">waitTime</span>: <span class="pl-c1">100</span><span class="pl-kos">,</span>
          <span class="pl-kos">}</span><span class="pl-kos">,</span>
        <span class="pl-kos">}</span><span class="pl-kos">,</span>
      <span class="pl-kos">}</span><span class="pl-kos">,</span>
      <span class="pl-s1">opt</span> <span class="pl-c1">||</span> <span class="pl-kos">{</span><span class="pl-kos">}</span><span class="pl-kos">,</span>
    <span class="pl-kos">)</span><span class="pl-kos">,</span>
  <span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span>
<span class="pl-k">export</span> <span class="pl-k">const</span> <span class="pl-s1">defHttp</span> <span class="pl-c1">=</span> <span class="pl-s1">createAxios</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">;</span></pre></div>
<h3>将axios封装成一个类</h3>
<h3>依据请求返回状态码显示提醒信息</h3></div>
<div style="font-size:small;margin-top:8px;float:right;"></div>

<button class="btn btn-block" type="button" onclick="openComments()" id="cmButton">评论</button>
<div class="comments" id="comments"></div>

</div>
    <div id="footer"><div id="footer1">Copyright © <span id="copyrightYear"></span> <a href="https://199yjy.github.io/record.github.io">yjieyan的私人博客</a></div>
<div id="footer2">
    <span id="runday"></span><span>Powered by <a href="https://meekdai.com/Gmeek.html" target="_blank">Gmeek</a></span>
</div>

<script>
var now=new Date();
document.getElementById("copyrightYear").innerHTML=now.getFullYear();

if(""!=""){
    var startSite=new Date("");
    var diff=now.getTime()-startSite.getTime();
    var diffDay=Math.floor(diff/(1000*60*60*24));
    document.getElementById("runday").innerHTML="网站运行"+diffDay+"天"+" • ";
}
</script></div>
</body>
<script>
var IconList={'sun': 'M8 10.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5zM8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0V.75A.75.75 0 018 0zm0 13a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0v-1.5A.75.75 0 018 13zM2.343 2.343a.75.75 0 011.061 0l1.06 1.061a.75.75 0 01-1.06 1.06l-1.06-1.06a.75.75 0 010-1.06zm9.193 9.193a.75.75 0 011.06 0l1.061 1.06a.75.75 0 01-1.06 1.061l-1.061-1.06a.75.75 0 010-1.061zM16 8a.75.75 0 01-.75.75h-1.5a.75.75 0 010-1.5h1.5A.75.75 0 0116 8zM3 8a.75.75 0 01-.75.75H.75a.75.75 0 010-1.5h1.5A.75.75 0 013 8zm10.657-5.657a.75.75 0 010 1.061l-1.061 1.06a.75.75 0 11-1.06-1.06l1.06-1.06a.75.75 0 011.06 0zm-9.193 9.193a.75.75 0 010 1.06l-1.06 1.061a.75.75 0 11-1.061-1.06l1.06-1.061a.75.75 0 011.061 0z', 'moon': 'M9.598 1.591a.75.75 0 01.785-.175 7 7 0 11-8.967 8.967.75.75 0 01.961-.96 5.5 5.5 0 007.046-7.046.75.75 0 01.175-.786zm1.616 1.945a7 7 0 01-7.678 7.678 5.5 5.5 0 107.678-7.678z', 'sync': 'M1.705 8.005a.75.75 0 0 1 .834.656 5.5 5.5 0 0 0 9.592 2.97l-1.204-1.204a.25.25 0 0 1 .177-.427h3.646a.25.25 0 0 1 .25.25v3.646a.25.25 0 0 1-.427.177l-1.38-1.38A7.002 7.002 0 0 1 1.05 8.84a.75.75 0 0 1 .656-.834ZM8 2.5a5.487 5.487 0 0 0-4.131 1.869l1.204 1.204A.25.25 0 0 1 4.896 6H1.25A.25.25 0 0 1 1 5.75V2.104a.25.25 0 0 1 .427-.177l1.38 1.38A7.002 7.002 0 0 1 14.95 7.16a.75.75 0 0 1-1.49.178A5.5 5.5 0 0 0 8 2.5Z', 'home': 'M6.906.664a1.749 1.749 0 0 1 2.187 0l5.25 4.2c.415.332.657.835.657 1.367v7.019A1.75 1.75 0 0 1 13.25 15h-3.5a.75.75 0 0 1-.75-.75V9H7v5.25a.75.75 0 0 1-.75.75h-3.5A1.75 1.75 0 0 1 1 13.25V6.23c0-.531.242-1.034.657-1.366l5.25-4.2Zm1.25 1.171a.25.25 0 0 0-.312 0l-5.25 4.2a.25.25 0 0 0-.094.196v7.019c0 .138.112.25.25.25H5.5V8.25a.75.75 0 0 1 .75-.75h3.5a.75.75 0 0 1 .75.75v5.25h2.75a.25.25 0 0 0 .25-.25V6.23a.25.25 0 0 0-.094-.195Z', 'github': 'M8 0c4.42 0 8 3.58 8 8a8.013 8.013 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z', 'copy': 'M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z', 'check': 'M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z'};
var utterancesLoad=0;

let themeSettings={
    "dark": ["dark","moon","#00f0ff","dark-blue"],
    "light": ["light","sun","#ff5000","github-light"],
    "auto": ["auto","sync","","preferred-color-scheme"]
};
function changeTheme(mode, icon, color, utheme){
    document.documentElement.setAttribute("data-color-mode",mode);
    document.getElementById("themeSwitch").setAttribute("d",value=IconList[icon]);
    document.getElementById("themeSwitch").parentNode.style.color=color;
    if(utterancesLoad==1){utterancesTheme(utheme);}
}
function modeSwitch(){
    let currentMode=document.documentElement.getAttribute('data-color-mode');
    let newMode = currentMode === "light" ? "dark" : currentMode === "dark" ? "auto" : "light";
    localStorage.setItem("meek_theme", newMode);
    if(themeSettings[newMode]){
        changeTheme(...themeSettings[newMode]);
    }
}
function utterancesTheme(theme){
    const message={type:'set-theme',theme: theme};
    const iframe=document.getElementsByClassName('utterances-frame')[0];
    iframe.contentWindow.postMessage(message,'https://utteranc.es');
}
if(themeSettings[theme]){changeTheme(...themeSettings[theme]);}
console.log("\n %c Gmeek last https://github.com/Meekdai/Gmeek \n","padding:5px 0;background:#02d81d;color:#fff");
</script>

<script>
document.getElementById("pathHome").setAttribute("d",IconList["home"]);
document.getElementById("pathIssue").setAttribute("d",IconList["github"]);



function openComments(){
    cm=document.getElementById("comments");
    cmButton=document.getElementById("cmButton");
    cmButton.innerHTML="loading";
    span=document.createElement("span");
    span.setAttribute("class","AnimatedEllipsis");
    cmButton.appendChild(span);

    script=document.createElement("script");
    script.setAttribute("src","https://utteranc.es/client.js");
    script.setAttribute("repo","199yjy/record.github.io");
    script.setAttribute("issue-term","title");
    
    if(localStorage.getItem("meek_theme")=="dark"){script.setAttribute("theme","dark-blue");}
    else if(localStorage.getItem("meek_theme")=="light") {script.setAttribute("theme","github-light");}
    else{script.setAttribute("theme","preferred-color-scheme");}
    
    script.setAttribute("crossorigin","anonymous");
    script.setAttribute("async","");
    cm.appendChild(script);

    int=self.setInterval("iFrameLoading()",200);
}

function iFrameLoading(){
    var utterances=document.getElementsByClassName('utterances');
    if(utterances.length==1){
        if(utterances[0].style.height!=""){
            utterancesLoad=1;
            int=window.clearInterval(int);
            document.getElementById("cmButton").style.display="none";
            console.log("utterances Load OK");
        }
    }
}

document.addEventListener('DOMContentLoaded', () => {
    const createClipboardHTML = (codeContent, additionalClasses = '') => `
        <pre class="notranslate"><code class="notranslate">${codeContent}</code></pre>
        <div class="clipboard-container position-absolute right-0 top-0 ${additionalClasses}">
            <clipboard-copy class="ClipboardButton btn m-2 p-0" role="button" style="display: inherit;">
                <svg height="16" width="16" class="octicon octicon-copy m-2"><path d="${IconList["copy"]}"></path></svg>
                <svg height="16" width="16" class="octicon octicon-check color-fg-success m-2 d-none"><path d="${IconList["check"]}"></path></svg>
            </clipboard-copy>
            <div class="copy-feedback">Copied!</div>
        </div>
    `;

    const handleCodeElements = (selector = '') => {
        document.querySelectorAll(selector).forEach(codeElement => {
            const codeContent = codeElement.innerHTML;
            const newStructure = document.createElement('div');
            newStructure.className = 'snippet-clipboard-content position-relative overflow-auto';
            newStructure.innerHTML = createClipboardHTML(codeContent);

            const parentElement = codeElement.parentElement;
            if (selector.includes('highlight')) {
                parentElement.insertBefore(newStructure, codeElement.nextSibling);
                parentElement.removeChild(codeElement);
            } else {
                parentElement.parentElement.replaceChild(newStructure, parentElement);
            }
        });
    };

    handleCodeElements('pre.notranslate > code.notranslate');
    handleCodeElements('div.highlight > pre.notranslate');

    let currentFeedback = null;
    document.querySelectorAll('clipboard-copy').forEach(copyButton => {
        copyButton.addEventListener('click', () => {
            const codeContent = copyButton.closest('.snippet-clipboard-content').innerText;
            const tempTextArea = document.createElement('textarea');
            tempTextArea.value = codeContent;
            document.body.appendChild(tempTextArea);
            tempTextArea.select();
            document.execCommand('copy');
            document.body.removeChild(tempTextArea);

            const copyIcon = copyButton.querySelector('.octicon-copy');
            const checkIcon = copyButton.querySelector('.octicon-check');
            const copyFeedback = copyButton.nextElementSibling;

            if (currentFeedback && currentFeedback !== copyFeedback) {currentFeedback.style.display = 'none';}
            currentFeedback = copyFeedback;

            copyIcon.classList.add('d-none');
            checkIcon.classList.remove('d-none');
            copyFeedback.style.display = 'block';
            copyButton.style.borderColor = 'var(--color-success-fg)';

            setTimeout(() => {
                copyIcon.classList.remove('d-none');
                checkIcon.classList.add('d-none');
                copyFeedback.style.display = 'none';
                copyButton.style.borderColor = '';
            }, 2000);
        });
    });
});

</script>


</html>
